<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Qu·∫£n L√Ω CV - Nh√† Tuy·ªÉn D·ª•ng</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0.8rem;
        }

        .back-btn {
            position: fixed;
            top: 1rem;
            left: 1rem;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            padding: 0.5rem 0.8rem;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: #667eea;
            text-decoration: none;
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            font-size: 0.8rem;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 1.5rem;
            color: white;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 0.95rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 1.2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .nav-tabs {
            display: flex;
            gap: 0.4rem;
            margin-bottom: 1.2rem;
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            padding: 0.4rem;
            border-radius: 25px;
            max-width: 480px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }

        .nav-tab {
            flex: 1;
            padding: 0.8rem 1rem;
            text-align: center;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #64748b;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            font-size: 0.85rem;
            position: relative;
            border: 2px solid transparent;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin: 0.1rem;
        }

        .nav-tab:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            color: #667eea;
            border-color: rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            transform: translateY(-3px);
            border-color: transparent;
        }

        .nav-tab .material-symbols-outlined {
            font-size: 1rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Upload and Filter Layout - Ultra Compact */
        .upload-filter-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
            margin-bottom: 0.8rem;
        }

        .upload-section {
            margin-bottom: 0;
        }

        /* Upload Section - Ultra Compact */
        .upload-area {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px dashed #e2e8f0;
            border-radius: 16px;
            padding: 0.8rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .upload-area:hover,
        .upload-area.drag-over {
            border-color: #667eea;
            background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .upload-area.drag-over {
            border-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
        }

        .upload-icon {
            font-size: 1.3rem;
            color: #667eea;
            margin-bottom: 0.3rem;
            transition: all 0.3s ease;
        }

        .upload-area.drag-over .upload-icon {
            color: #10b981;
            transform: scale(1.1);
        }

        .upload-area h3 {
            font-size: 0.85rem;
            margin-bottom: 0.2rem;
            color: #1a202c;
            font-weight: 600;
        }

        .upload-area p {
            color: #4a5568;
            margin-bottom: 0;
            font-size: 0.7rem;
        }

        .file-input {
            display: none;
        }

        /* Filter Section - Ultra Compact */
        .filter-section {
            background: #f8fafc;
            padding: 0.8rem;
            border-radius: 16px;
            margin-bottom: 0;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .filter-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.2rem;
            color: #2d3748;
            font-size: 0.7rem;
        }

        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 0.35rem;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.7rem;
            transition: border-color 0.3s ease;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-actions {
            display: flex;
            gap: 0.6rem;
            margin-top: 0.8rem;
            justify-content: center;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.8rem;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
        }

        /* CV List - Ultra Compact */
        .cv-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 0.8rem;
            margin-bottom: 0.8rem;
        }

        .cv-card {
            background: white;
            border-radius: 16px;
            padding: 0.8rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .cv-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .cv-card.excellent {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.02), white);
        }

        .cv-card.good {
            border-color: #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.02), white);
        }

        .cv-card.average {
            border-color: #f59e0b;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.02), white);
        }

        .cv-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .cv-name {
            font-size: 0.9rem;
            font-weight: 700;
            color: #1a202c;
        }

        .cv-score {
            padding: 0.12rem 0.4rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.7rem;
        }

        .score-excellent {
            background: #10b981;
            color: white;
        }

        .score-good {
            background: #3b82f6;
            color: white;
        }

        .score-average {
            background: #f59e0b;
            color: white;
        }

        .score-poor {
            background: #ef4444;
            color: white;
        }

        .cv-details {
            display: grid;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .cv-detail {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.7rem;
            color: #4a5568;
        }

        .cv-detail .material-symbols-outlined {
            font-size: 0.8rem;
            color: #667eea;
        }

        .cv-actions {
            display: flex;
            gap: 0.25rem;
        }

        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 0.65rem;
            border-radius: 16px;
        }

        /* Statistics Dashboard - Ultra Compact */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.6rem;
            margin-bottom: 0.8rem;
        }

        .stat-card {
            background: white;
            padding: 0.6rem;
            border-radius: 16px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 32px;
            height: 32px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.4rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .stat-icon.excellent {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .stat-icon.good {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .stat-icon.average {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .stat-icon .material-symbols-outlined {
            color: white;
            font-size: 1rem;
        }

        .stat-info h3 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.1rem;
            color: #1a202c;
        }

        .stat-info p {
            color: #4a5568;
            font-weight: 500;
            margin: 0;
            font-size: 0.7rem;
        }

        .analytics-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .analytics-left,
        .analytics-right {
            background: white;
            padding: 1rem;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .top-performers h3 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: #1a202c;
        }

        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: #f8fafc;
        }
        
        /* CV Scoring Settings Styles - Ultra Compact */
        .scoring-settings-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
            margin-top: 0.8rem;
            position: relative;
        }
        
        /* Decorative element - smaller */
        .scoring-settings-container::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.08));
            border-radius: 50%;
            z-index: 0;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.1);
        }
            
        .scoring-criteria-section,
        .scoring-preview-section {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            z-index: 1;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }
        
        .scoring-criteria-section:hover,
        .scoring-preview-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.12);
        }
        
        /* Section headers with decoration - compact */
        .criteria-header,
        .preview-header {
            margin-bottom: 0.8rem;
            padding-bottom: 0.6rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .criteria-header::after,
        .preview-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 30px;
            height: 1px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 1px;
        }
            
        .criteria-header h3,
        .preview-header h3 {
            font-size: 1rem;
            margin: 0;
            color: #1a202c;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .criteria-header h3::before {
            content: 'üéØ';
            font-size: 1.1rem;
        }
        
        .preview-header h3::before {
            content: 'üìä';
            font-size: 1.1rem;
        }
            
        .criteria-header p {
            color: #4a5568;
            margin: 0;
            font-weight: 600;
            padding: 0.3rem 0.8rem;
            background: #f8fafc;
            border-radius: 20px;
            border: 1px solid #e2e8f0;
            font-size: 0.85rem;
        }
            
        #total-weight {
            color: #667eea;
            font-weight: 700;
            font-size: 1.1rem;
        }
            
        .criteria-form {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }
            
        .criteria-item {
            padding: 1rem;
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border-radius: 10px;
            border-left: 4px solid transparent;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        }
        
        .criteria-item:nth-child(1) {
            border-left-color: #3b82f6; /* Blue */
        }
        
        .criteria-item:nth-child(2) {
            border-left-color: #60a5fa; /* Light Blue */
        }
        
        .criteria-item:nth-child(3) {
            border-left-color: #34d399; /* Green */
        }
        
        .criteria-item:nth-child(4) {
            border-left-color: #10b981; /* Emerald */
        }
        
        .criteria-item:nth-child(5) {
            border-left-color: #a78bfa; /* Purple */
        }
        
        .criteria-item:nth-child(6) {
            border-left-color: #8b5cf6; /* Violet */
        }
        
        .criteria-item:nth-child(7) {
            border-left-color: #fbbf24; /* Yellow */
        }
        
        .criteria-item:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.08);
        }
            
        .criteria-item label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: 600;
            color: #2d3748;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            flex-wrap: wrap;
        }
        
        .criteria-item label small {
            margin-left: 1.2rem;
            background: #f0f4f8;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #4a5568;
        }
        
        .criteria-item label b {
            color: #667eea;
            font-weight: 700;
            font-size: 0.95rem;
        }
        
        .criteria-item:nth-child(1) label::before {
            content: 'üéØ';
        }
        
        .criteria-item:nth-child(2) label::before {
            content: 'üìù';
        }
        
        .criteria-item:nth-child(3) label::before {
            content: 'üíº';
        }
        
        .criteria-item:nth-child(4) label::before {
            content: 'üìä';
        }
        
        .criteria-item:nth-child(5) label::before {
            content: 'üîß';
        }
        
        .criteria-item:nth-child(6) label::before {
            content: 'ü§ù';
        }
        
        .criteria-item:nth-child(7) label::before {
            content: 'üéì';
        }
            
        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.8rem;
            position: relative;
            background: rgba(247, 250, 252, 0.7);
            padding: 0.6rem 0.8rem;
            border-radius: 8px;
        }
        
        .slider-track {
            position: absolute;
            height: 8px;
            border-radius: 5px;
            background: #e2e8f0;
            width: 100%;
            z-index: 0;
        }
            
        .weight-slider {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            border-radius: 5px;
            outline: none;
            position: relative;
            z-index: 1;
        }
            
        .weight-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border: 2px solid #667eea;
        }
        
        .criteria-item:nth-child(1) .weight-slider::-webkit-slider-thumb {
            border-color: #3b82f6; /* Blue */
        }
        
        .criteria-item:nth-child(2) .weight-slider::-webkit-slider-thumb {
            border-color: #60a5fa; /* Light Blue */
        }
        
        .criteria-item:nth-child(3) .weight-slider::-webkit-slider-thumb {
            border-color: #34d399; /* Green */
        }
        
        .criteria-item:nth-child(4) .weight-slider::-webkit-slider-thumb {
            border-color: #10b981; /* Emerald */
        }
        
        .criteria-item:nth-child(5) .weight-slider::-webkit-slider-thumb {
            border-color: #a78bfa; /* Purple */
        }
        
        .criteria-item:nth-child(6) .weight-slider::-webkit-slider-thumb {
            border-color: #8b5cf6; /* Violet */
        }
        
        .criteria-item:nth-child(7) .weight-slider::-webkit-slider-thumb {
            border-color: #fbbf24; /* Yellow */
        }
            
        .weight-slider::-webkit-slider-thumb:hover {
            transform: scale(1.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        /* Firefox styles */
        .weight-slider::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border: 2px solid #667eea;
        }
        
        .weight-slider::-moz-range-thumb:hover {
            transform: scale(1.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
            
        .weight-value {
            font-weight: 700;
            font-size: 1rem;
            min-width: 60px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            text-align: center;
            color: white;
            background: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            position: relative;
        }
        
        .weight-value::after {
            content: '%';
            font-size: 0.95rem;
            margin-left: 2px;
        }
        
        .criteria-item:nth-child(1) .weight-value {
            background: #3b82f6; /* Blue */
        }
        
        .criteria-item:nth-child(2) .weight-value {
            background: #60a5fa; /* Light Blue */
        }
        
        .criteria-item:nth-child(3) .weight-value {
            background: #34d399; /* Green */
        }
        
        .criteria-item:nth-child(4) .weight-value {
            background: #10b981; /* Emerald */
        }
        
        .criteria-item:nth-child(5) .weight-value {
            background: #a78bfa; /* Purple */
        }
        
        .criteria-item:nth-child(6) .weight-value {
            background: #8b5cf6; /* Violet */
        }
        
        .criteria-item:nth-child(7) .weight-value {
            background: #fbbf24; /* Yellow */
        }
            
        .criteria-details {
            font-size: 0.8rem;
            color: #718096;
            padding: 0.6rem;
            background: rgba(247, 250, 252, 0.7);
            border-radius: 6px;
            margin-top: 0.5rem;
            border-left: 2px solid #e2e8f0;
        }
        
        .criteria-item:nth-child(1) .criteria-details {
            border-left-color: rgba(59, 130, 246, 0.4); /* Blue */
        }
        
        .criteria-item:nth-child(2) .criteria-details {
            border-left-color: rgba(96, 165, 250, 0.4); /* Light Blue */
        }
        
        .criteria-item:nth-child(3) .criteria-details {
            border-left-color: rgba(52, 211, 153, 0.4); /* Green */
        }
        
        .criteria-item:nth-child(4) .criteria-details {
            border-left-color: rgba(16, 185, 129, 0.4); /* Emerald */
        }
        
        .criteria-item:nth-child(5) .criteria-details {
            border-left-color: rgba(167, 139, 250, 0.4); /* Purple */
        }
        
        .criteria-item:nth-child(6) .criteria-details {
            border-left-color: rgba(139, 92, 246, 0.4); /* Violet */
        }
        
        .criteria-item:nth-child(7) .criteria-details {
            border-left-color: rgba(251, 191, 36, 0.4); /* Yellow */
        }
            
        .weight-warning {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            background: linear-gradient(135deg, #FEF2F2, #FFEDD5);
            padding: 0.8rem 1rem;
            border-radius: 8px;
            color: #9A3412;
            margin: 1rem 0;
            border-left: 3px solid #F87171;
            box-shadow: 0 2px 8px rgba(248, 113, 113, 0.1);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(248, 113, 113, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(248, 113, 113, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(248, 113, 113, 0);
            }
        }
        
        .settings-actions {
            margin-top: 1.5rem;
            display: flex;
            gap: 0.8rem;
        }
        
        .settings-actions button {
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .settings-actions button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .settings-actions .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .settings-actions .btn-secondary {
            background: #f8fafc;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }
        
        .preview-chart-container {
            height: 220px;
            margin-bottom: 1.2rem;
            position: relative;
        }
        
        .preview-chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(247, 250, 252, 0.5));
            border-radius: 16px;
            z-index: -1;
        }
            
        .preview-note {
            background: linear-gradient(135deg, #EFF6FF, #EEF2FF);
            padding: 0.8rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #1E40AF;
            margin-top: 1rem;
            border-left: 3px solid #3B82F6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }
            
        .settings-actions {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
        }
            
        .preview-chart-container {
            height: 250px;
            margin-bottom: 1.5rem;
        }
            
        .preview-note {
            background: #EFF6FF;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #1E40AF;
            margin-top: 1.5rem;
        }

        .ranking-item:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }

        .rank-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            margin-right: 1rem;
            font-size: 1.1rem;
        }

        .rank-1 { background: #ffd700; }
        .rank-2 { background: #c0c0c0; }
        .rank-3 { background: #cd7f32; }
        .rank-other { background: #64748b; }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 0.2rem;
        }

        .ranking-position {
            font-size: 0.9rem;
            color: #4a5568;
        }

        .ranking-score {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-left: 1rem;
        }

        .charts-container {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .chart-card {
            background: #f8fafc;
            padding: 0.8rem;
            border-radius: 6px;
        }

        .chart-card h3,
        .chart-card h4 {
            margin-bottom: 0.6rem;
            color: #1a202c;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .chart-card canvas {
            max-height: 140px;
        }

        /* Section headers - Ultra Compact */
        .section-header {
            margin-bottom: 0.8rem;
        }

        .section-header h2 {
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
            color: #1a202c;
            font-weight: 700;
        }

        .section-header h3 {
            font-size: 1rem;
            margin-bottom: 0.3rem;
            color: #1a202c;
            font-weight: 700;
        }

        .section-header p {
            color: #4a5568;
            font-size: 0.8rem;
            margin: 0;
        }

        /* Database Stats */
        .database-stats {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-top: 0.4rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.75rem;
            color: #4a5568;
            font-weight: 600;
        }

        .stat-item .material-symbols-outlined {
            font-size: 1rem;
            color: #667eea;
        }

        .chart-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .chart-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1a202c;
        }

        /* Excel-style Ranking Table - Ultra Compact */
        .ranking-table-container {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0;
            margin-top: 1rem;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.7rem;
            line-height: 1.4;
        }

        .ranking-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.6rem 0.4rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.7rem;
            letter-spacing: 0.2px;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            position: sticky;
            top: 0;
            z-index: 10;
            text-transform: uppercase;
        }

        .ranking-table th:last-child {
            border-right: none;
        }

        .ranking-table td {
            padding: 0.5rem 0.4rem;
            border-bottom: 1px solid #e2e8f0;
            border-right: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        .ranking-table td:last-child {
            border-right: none;
        }

        .ranking-table tbody tr {
            transition: all 0.2s ease;
        }

        .ranking-table tbody tr:hover {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .ranking-table tbody tr:nth-child(even) {
            background: #fafbfc;
        }

        .ranking-table tbody tr:nth-child(even):hover {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        }

        .rank-cell {
            width: 40px;
            text-align: center;
        }

        .rank-badge {
            width: 24px;
            height: 24px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 0.7rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .rank-1 { 
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #8B4513;
        }
        .rank-2 { 
            background: linear-gradient(135deg, #C0C0C0, #A9A9A9);
            color: #2F4F4F;
        }
        .rank-3 { 
            background: linear-gradient(135deg, #CD7F32, #A0522D);
            color: white;
        }
        .rank-other { 
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
        }

        .candidate-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .candidate-avatar {
            width: 28px;
            height: 28px;
            border-radius: 10px;
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #475569;
            font-size: 0.75rem;
        }

        .candidate-details h4 {
            margin: 0;
            font-size: 0.8rem;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.3;
        }

        .candidate-details p {
            margin: 0;
            font-size: 0.7rem;
            color: #64748b;
            line-height: 1.2;
        }

        .position-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            background: #f1f5f9;
            color: #475569;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            border: 1px solid #e2e8f0;
        }

        .experience-cell {
            text-align: center;
            font-weight: 500;
            color: #475569;
            font-size: 0.7rem;
        }

        .score-cell {
            text-align: center;
        }

        .score-badge {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.75rem;
            min-width: 40px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .score-excellent {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .score-good {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .score-average {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .score-poor {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .actions-cell {
            text-align: center;
        }

        .action-buttons {
            display: flex;
            gap: 0.2rem;
            justify-content: center;
        }

        .action-btn {
            padding: 0.2rem 0.4rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.65rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .action-btn.secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .action-btn .material-symbols-outlined {
            font-size: 0.75rem;
        }

        /* Table responsive scroll */
        .table-scroll {
            max-height: 500px;
            overflow-y: auto;
        }

        .table-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .table-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .table-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .table-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: #667eea;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Recruitment Chatbot Styles */
        .chatbot-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1000;
            transform: translateY(100vh);
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .chatbot-container.open {
            transform: translateY(0);
        }

        .chatbot-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .chatbot-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
            animation: float 6s ease-in-out infinite;
        }

        .chatbot-title {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-weight: 700;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }

        .chatbot-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }
        .chatbot-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .chatbot-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .chatbot-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
        }

        .message {
            display: flex;
            align-items: flex-start;
            gap: 0.8rem;
            max-width: 85%;
            animation: slideIn 0.3s ease-out;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1rem;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .message-content {
            padding: 0.8rem 1.2rem;
            border-radius: 20px;
            font-size: 0.9rem;
            line-height: 1.5;
            position: relative;
        }
        .message.bot .message-content {
            background: white;
            border: 1px solid #e2e8f0;
            color: #2d3748;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .message.user .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .message-time {
            font-size: 0.75rem;
            opacity: 0.6;
            margin-top: 0.3rem;
            text-align: right;
        }
        .message.bot .message-time {
            text-align: left;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 1rem 0;
        }
        .typing-dots {
            display: flex;
            gap: 0.3rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typingPulse 1.4s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.8rem;
        }

        .suggestion-chip {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.2);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .suggestion-chip:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
        }

        .chatbot-input {
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            background: white;
        }

        .input-container {
            display: flex;
            gap: 0.8rem;
            align-items: flex-end;
        }

        .chatbot-textarea {
            flex: 1;
            border: 1px solid #e2e8f0;
            border-radius: 25px;
            padding: 0.8rem 1rem;
            font-size: 0.9rem;
            resize: none;
            max-height: 80px;
            min-height: 40px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .chatbot-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .send-button {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .chatbot-toggle {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            z-index: 999;
            font-size: 1.3rem;
        }

        .chatbot-toggle:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .notification-badge {
            position: absolute;
            top: -3px;
            right: -3px;
            width: 16px;
            height: 16px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            font-size: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            animation: bounceIn 0.5s ease;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        @keyframes typingPulse {
            0%, 60%, 100% { 
                transform: scale(1); 
                opacity: 0.4; 
            }
            30% { 
                transform: scale(1.2); 
                opacity: 1; 
            }
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        @keyframes slideInRight {
            from { 
                opacity: 0; 
                transform: translateX(100%); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }

        /* Mobile responsiveness - Ultra Compact */
        @media (max-width: 768px) {
            .container {
                padding: 0.6rem;
            }

            .header h1 {
                font-size: 1.6rem;
            }

            .header p {
                font-size: 0.8rem;
            }

            .main-content {
                padding: 1rem;
                border-radius: 16px;
            }

            .nav-tabs {
                flex-direction: column;
                gap: 0.2rem;
                max-width: 100%;
            }

            .nav-tab {
                padding: 0.6rem 0.8rem;
                font-size: 0.75rem;
            }

            .upload-filter-container {
                grid-template-columns: 1fr;
                gap: 0.6rem;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            .cv-grid {
                grid-template-columns: 1fr;
            }

            .analytics-content {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.6rem;
            }

            .ranking-table-container {
                overflow-x: auto;
            }

            .ranking-table {
                min-width: 500px;
            }

            .ranking-table th,
            .ranking-table td {
                padding: 0.4rem 0.3rem;
                font-size: 0.65rem;
            }

            .candidate-info {
                gap: 0.3rem;
            }

            .candidate-avatar {
                width: 24px;
                height: 24px;
                font-size: 0.65rem;
            }

            .candidate-details h4 {
                font-size: 0.75rem;
            }

            .candidate-details p {
                font-size: 0.6rem;
            }

            .action-buttons {
                flex-direction: column;
                gap: 0.15rem;
            }

            .action-btn {
                padding: 0.15rem 0.3rem;
                font-size: 0.6rem;
            }

            .chatbot-container {
                width: calc(100vw - 1rem);
                height: calc(100vh - 2rem);
                bottom: 0.5rem;
                right: 0.5rem;
                left: 0.5rem;
                border-radius: 20px;
            }

            .chatbot-toggle {
                bottom: 0.8rem;
                right: 0.8rem;
                width: 45px;
                height: 45px;
                font-size: 1.2rem;
            }

            /* Mobile - Compact Settings */
            .scoring-settings-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .scoring-criteria-section,
            .scoring-preview-section {
                padding: 0.8rem;
            }

            .criteria-form {
                gap: 1rem;
            }

            .criteria-item {
                padding: 0.8rem;
            }

            .criteria-item label {
                font-size: 0.85rem;
                gap: 0.3rem;
            }

            .criteria-item label small {
                margin-left: 0.8rem;
                font-size: 0.75rem;
            }

            .slider-container {
                gap: 0.8rem;
                padding: 0.5rem 0.6rem;
            }

            .weight-value {
                min-width: 50px;
                height: 28px;
                font-size: 0.85rem;
            }

            .criteria-details {
                font-size: 0.75rem;
                padding: 0.5rem;
            }

            .settings-actions {
                flex-direction: column;
                gap: 0.6rem;
            }

            .settings-actions button {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }

            .preview-chart-container {
                height: 180px;
            }

            .preview-note {
                font-size: 0.75rem;
                padding: 0.6rem 0.8rem;
            }
        }

        /* Tablet responsiveness */
        @media (max-width: 1024px) and (min-width: 769px) {
            .container {
                padding: 1rem;
            }

            .analytics-content {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <a href="../../giao di·ªán ch√≠nh/index.html" class="back-btn">
        <span class="material-symbols-outlined">arrow_back</span>
        Quay l·∫°i
    </a>

    <div class="container">
        <div class="header">
            <h1>üè¢ H·ªá Th·ªëng Qu·∫£n L√Ω CV</h1>
            <p>Qu·∫£n l√Ω, l·ªçc v√† ƒë√°nh gi√° ·ª©ng vi√™n hi·ªáu qu·∫£ v·ªõi AI</p>
        </div>

        <div class="main-content">
            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="management">
                    <span class="material-symbols-outlined">folder_managed</span>
                    Qu·∫£n L√Ω CV
                </div>
                <div class="nav-tab" data-tab="analytics">
                    <span class="material-symbols-outlined">analytics</span>
                    B·∫£ng Ph√¢n T√≠ch
                </div>
                <div class="nav-tab" data-tab="settings">
                    <span class="material-symbols-outlined">tune</span>
                    T√πy Ch·ªânh Ti√™u Ch√≠
                </div>
            </div>

            <!-- CV Management Tab (Combined Upload + Manage) -->
            <div class="tab-content active" id="management-tab">
                <!-- Upload and Filter Container -->
                <div class="upload-filter-container">
                    <!-- Quick Upload Section -->
                    <div class="upload-section">
                        <div class="section-header">
                            <h2 style="font-size: 1rem; margin-bottom: 0.3rem; color: #1a202c;">üìÅ T·∫£i L√™n CV</h2>
                            <p style="font-size: 0.75rem; color: #64748b; margin: 0;">K√©o th·∫£ ho·∫∑c click ƒë·ªÉ ch·ªçn file</p>
                        </div>
                        
                        <div class="upload-area" id="upload-area">
                            <div class="upload-icon">
                                <span class="material-symbols-outlined">cloud_upload</span>
                            </div>
                            <h3>Th·∫£ file CV v√†o ƒë√¢y</h3>
                            <p>PDF, DOC, DOCX, JPG, PNG (Max 10MB)</p>
                            <input type="file" id="cv-files" class="file-input" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                        </div>

                        <div id="upload-progress" style="display: none;">
                            <div style="background: #e2e8f0; border-radius: 10px; height: 8px; margin: 1rem 0;">
                                <div id="progress-bar" style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; border-radius: 10px; width: 0%; transition: width 0.3s ease;"></div>
                            </div>
                            <p id="upload-status">ƒêang x·ª≠ l√Ω file...</p>
                        </div>

                        <div id="upload-results" style="display: none;">
                            <h4 style="margin-bottom: 0.8rem; font-size: 1rem;">K·∫øt Qu·∫£:</h4>
                            <div id="results-list"></div>
                        </div>
                    </div>

                    <!-- Advanced Filters & Search -->
                    <div class="filter-section">
                        <div class="section-header">
                            <h2 style="font-size: 1rem; margin-bottom: 0.3rem; color: #1a202c;">üîç B·ªô L·ªçc & T√¨m Ki·∫øm</h2>
                            <p style="font-size: 0.75rem; color: #64748b; margin: 0;">L·ªçc trong c∆° s·ªü d·ªØ li·ªáu CV</p>
                        </div>
                        
                        <div class="filter-grid">
                            <div class="filter-group">
                                <label>V·ªã Tr√≠</label>
                                <select id="filter-position">
                                    <option value="">T·∫•t c·∫£ v·ªã tr√≠</option>
                                    <option value="frontend">Frontend Developer</option>
                                    <option value="backend">Backend Developer</option>
                                    <option value="fullstack">Fullstack Developer</option>
                                    <option value="mobile">Mobile Developer</option>
                                    <option value="data">Data Scientist</option>
                                    <option value="design">UI/UX Designer</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="other">Kh√°c</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Kinh Nghi·ªám</label>
                                <select id="filter-experience">
                                    <option value="">T·∫•t c·∫£ c·∫•p ƒë·ªô</option>
                                    <option value="0-1">Fresher (0-1 nƒÉm)</option>
                                    <option value="1-3">Junior (1-3 nƒÉm)</option>
                                    <option value="3-5">Middle (3-5 nƒÉm)</option>
                                    <option value="5+">Senior (5+ nƒÉm)</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>ƒêi·ªÉm CV</label>
                                <select id="filter-score">
                                    <option value="">T·∫•t c·∫£ ƒëi·ªÉm</option>
                                    <option value="90-100">Xu·∫•t s·∫Øc (90-100)</option>
                                    <option value="80-89">T·ªët (80-89)</option>
                                    <option value="70-79">Kh√° (70-79)</option>
                                    <option value="0-69">C·∫ßn c·∫£i thi·ªán (<70)</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>T·ª´ Kh√≥a</label>
                                <input type="text" id="search-keyword" placeholder="T√™n, k·ªπ nƒÉng, c√¥ng ty...">
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button class="btn btn-primary" id="apply-filters">
                                <span class="material-symbols-outlined">search</span>
                                √Åp D·ª•ng
                            </button>
                            <button class="btn btn-secondary" id="reset-filters">
                                <span class="material-symbols-outlined">refresh</span>
                                ƒê·∫∑t L·∫°i
                            </button>
                        </div>
                    </div>
                </div>

                <!-- CV Database Grid -->
                <div class="cv-database-section">
                    <div class="section-header">
                        <h2 style="font-size: 1.1rem; margin-bottom: 0.5rem; color: #1a202c;">K·∫øt Qu·∫£ L·ªçc CV</h2>
                        <div class="database-stats" style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <span class="stat-item" style="display: flex; align-items: center; gap: 0.3rem; font-size: 0.75rem; color: #64748b;">
                                <span class="material-symbols-outlined" style="font-size: 1rem; color: #667eea;">folder</span>
                                <span id="total-cvs">0</span> T·ªïng CV
                            </span>
                            <span class="stat-item" style="display: flex; align-items: center; gap: 0.3rem; font-size: 0.75rem; color: #64748b;">
                                <span class="material-symbols-outlined" style="font-size: 1rem; color: #10b981;">star</span>
                                <span id="excellent-cvs">0</span> Xu·∫•t s·∫Øc
                            </span>
                            <span class="stat-item" style="display: flex; align-items: center; gap: 0.3rem; font-size: 0.75rem; color: #64748b;">
                                <span class="material-symbols-outlined" style="font-size: 1rem; color: #3b82f6;">trending_up</span>
                                <span id="good-cvs">0</span> T·ªët
                            </span>
                        </div>
                    </div>
                    
                    <div class="cv-grid" id="cv-grid">
                        <!-- CV cards will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Analytics Dashboard Tab (Combined Ranking + Statistics) -->
            <div class="tab-content" id="analytics-tab">
                <!-- Performance Overview -->
                <div class="analytics-overview">
                    <div class="section-header">
                        <h2 style="font-size: 1.2rem; margin-bottom: 0.5rem; color: #1a202c;">üìà T·ªïng Quan Hi·ªáu Su·∫•t</h2>
                        <p style="font-size: 0.8rem; color: #64748b; margin: 0;">C√°c ch·ªâ s·ªë v√† th√¥ng tin chi ti·∫øt t·ª´ c∆° s·ªü d·ªØ li·ªáu CV c·ªßa b·∫°n</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <span class="material-symbols-outlined">folder</span>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-total">0</h3>
                                <p>T·ªïng CV</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon excellent">
                                <span class="material-symbols-outlined">star</span>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-excellent">0</h3>
                                <p>CV Xu·∫•t s·∫Øc</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon good">
                                <span class="material-symbols-outlined">trending_up</span>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-good">0</h3>
                                <p>CV T·ªët</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon average">
                                <span class="material-symbols-outlined">analytics</span>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-average">0</h3>
                                <p>ƒêi·ªÉm Trung B√¨nh</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Performers & Charts -->
                <div class="analytics-content">
                    <div class="analytics-left">
                        <div class="top-performers">
                            <div class="section-header">
                                <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem; color: #1a202c;">üèÜ B·∫£ng X·∫øp H·∫°ng CV</h3>
                                <p style="font-size: 0.8rem; color: #64748b; margin: 0;">Ranking ·ª©ng vi√™n theo ƒëi·ªÉm ƒë√°nh gi√° t·ªïng th·ªÉ</p>
                            </div>
                            
                            <!-- Excel-style Table -->
                            <div class="ranking-table-container">
                                <div class="table-scroll">
                                    <table class="ranking-table" id="ranking-table">
                                        <thead>
                                            <tr>
                                                <th class="rank-cell">H·∫°ng</th>
                                                <th>·ª®ng Vi√™n</th>
                                                <th>V·ªã Tr√≠</th>
                                                <th>Kinh Nghi·ªám</th>
                                                <th>ƒêi·ªÉm CV</th>
                                                <th>Thao T√°c</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ranking-tbody">
                                            <!-- Ranking data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-right">
                        <div class="charts-container">
                            <div class="chart-card">
                                <h3>Score Distribution</h3>
                                <canvas id="scoreChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h3>Position Distribution</h3>
                                <canvas id="positionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- CV Scoring Settings Tab -->
            <div class="tab-content" id="settings-tab">
                <div class="section-header">
                    <h2 style="font-size: 1.2rem; margin-bottom: 0.4rem; color: #1a202c;">‚öôÔ∏è T√πy Ch·ªânh Ti√™u Ch√≠ ƒê√°nh Gi√° CV</h2>
                    <p style="font-size: 0.85rem; color: #64748b; margin: 0;">ƒêi·ªÅu ch·ªânh tr·ªçng s·ªë ƒë√°nh gi√° CV theo nhu c·∫ßu tuy·ªÉn d·ª•ng</p>
                </div>

                <div class="scoring-settings-container">
                    <div class="scoring-criteria-section">
                        <div class="criteria-header">
                            <h3>Ti√™u Ch√≠ ƒê√°nh Gi√°</h3>
                            <p>T·ªïng ƒëi·ªÉm: <span id="total-weight">100</span>%</p>
                        </div>
                        
                        <!-- Industry Template Selector -->
                        <div class="template-selector" style="margin-bottom: 1rem; padding: 0.8rem; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 8px; border: 1px solid #bae6fd;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.6rem;">
                                <span style="font-size: 1.1rem;">üéØ</span>
                                <h4 style="font-size: 0.9rem; font-weight: 600; color: #0c4a6e; margin: 0;">M·∫´u Ti√™u Ch√≠ Theo Ng√†nh</h4>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr auto; gap: 0.6rem; align-items: end;">
                                <div>
                                    <label for="industry-template" style="display: block; font-size: 0.75rem; font-weight: 600; color: #0f172a; margin-bottom: 0.3rem;">Ch·ªçn ng√†nh ngh·ªÅ:</label>
                                    <select id="industry-template" style="width: 100%; padding: 0.4rem 0.6rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.8rem; background: white;">
                                        <option value="">-- T√πy ch·ªânh th·ªß c√¥ng --</option>
                                        <option value="it-software">üñ•Ô∏è C√¥ng Ngh·ªá Th√¥ng Tin / Ph·∫ßn M·ªÅm</option>
                                        <option value="marketing-sales">üìà Marketing / B√°n H√†ng</option>
                                        <option value="finance-accounting">üí∞ T√†i Ch√≠nh / K·∫ø To√°n</option>
                                        <option value="human-resources">üë• Nh√¢n S·ª± / Tuy·ªÉn D·ª•ng</option>
                                        <option value="design-creative">üé® Thi·∫øt K·∫ø / S√°ng T·∫°o</option>
                                        <option value="engineering-manufacturing">‚öôÔ∏è K·ªπ Thu·∫≠t / S·∫£n Xu·∫•t</option>
                                        <option value="healthcare-medical">üè• Y T·∫ø / ChƒÉm S√≥c S·ª©c Kh·ªèe</option>
                                        <option value="education-training">üìö Gi√°o D·ª•c / ƒê√†o T·∫°o</option>
                                    </select>
                                </div>
                                <button type="button" onclick="applyIndustryTemplate()" style="padding: 0.4rem 0.8rem; background: linear-gradient(135deg, #0ea5e9, #0284c7); color: white; border: none; border-radius: 6px; font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                                    √Åp D·ª•ng
                                </button>
                            </div>
                            <p style="font-size: 0.7rem; color: #475569; margin: 0.4rem 0 0 0; font-style: italic;">üí° Ch·ªçn ng√†nh ngh·ªÅ ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh tr·ªçng s·ªë ph√π h·ª£p</p>
                        </div>
                        
                        <div class="criteria-form">
                            <div class="criteria-item">
                                <label for="job-relevance-weight">M·ª©c ƒë·ªô Ph√π h·ª£p v·ªõi V·ªã tr√≠ <small>(Tr·ªçng s·ªë hi·ªán t·∫°i: <b id="job-relevance-percent">25%</b>)</small></label>
                                <div class="slider-container">
                                    <div class="slider-track"></div>
                                    <input type="range" min="5" max="50" value="25" class="weight-slider" id="job-relevance-weight">
                                    <span class="weight-value" id="job-relevance-value">25</span>
                                </div>
                                <div class="criteria-details">
                                    <p>ƒê√°nh gi√° m·ª©c ƒë·ªô ph√π h·ª£p c·ªßa k·ªπ nƒÉng, kinh nghi·ªám v·ªõi y√™u c·∫ßu c·ª• th·ªÉ c·ªßa v·ªã tr√≠ (ƒëi·ªÉm cao nh·∫•t cho s·ª± kh·ªõp v·ªõi JD)</p>
                                </div>
                            </div>

                            <div class="criteria-item">
                                <label for="professionalism-weight">Chuy√™n Nghi·ªáp & R√µ R√†ng <small>(Tr·ªçng s·ªë hi·ªán t·∫°i: <b id="professionalism-percent">15%</b>)</small></label>
                                <div class="slider-container">
                                    <div class="slider-track"></div>
                                    <input type="range" min="5" max="50" value="15" class="weight-slider" id="professionalism-weight">
                                    <span class="weight-value" id="professionalism-value">15</span>
                                </div>
                                <div class="criteria-details">
                                    <p>ƒê√°nh gi√° email, s·ªë ƒëi·ªán tho·∫°i, h·ªç t√™n ƒë·∫ßy ƒë·ªß, c·∫•u tr√∫c CV v√† m·ª©c ƒë·ªô chi ti·∫øt c·ªßa CV</p>
                                </div>
                            </div>
                            <div class="criteria-item">
                                <label for="experience-weight">Kinh Nghi·ªám L√†m Vi·ªác <small>(Tr·ªçng s·ªë hi·ªán t·∫°i: <b id="experience-percent">20%</b>)</small></label>
                                <div class="slider-container">
                                    <div class="slider-track"></div>
                                    <input type="range" min="5" max="50" value="20" class="weight-slider" id="experience-weight">
                                    <span class="weight-value" id="experience-value">20</span>
                                </div>
                                <div class="criteria-details">
                                    <p>ƒê√°nh gi√° s·ªë l∆∞·ª£ng v√† ch·∫•t l∆∞·ª£ng kinh nghi·ªám l√†m vi·ªác d·ª±a tr√™n th·ªùi gian v√† v·ªã tr√≠</p>
                                </div>
                            </div>

                            <div class="criteria-item">
                                <label for="achievements-weight">Th√†nh t·ª±u & K·∫øt qu·∫£ <small>(Tr·ªçng s·ªë hi·ªán t·∫°i: <b id="achievements-percent">15%</b>)</small></label>
                                <div class="slider-container">
                                    <div class="slider-track"></div>
                                    <input type="range" min="5" max="50" value="15" class="weight-slider" id="achievements-weight">
                                    <span class="weight-value" id="achievements-value">15</span>
                                </div>
                                <div class="criteria-details">
                                    <p>ƒê√°nh gi√° th√†nh t·ª±u c·ª• th·ªÉ v·ªõi con s·ªë/ph·∫ßn trƒÉm, ch·ª©ng minh hi·ªáu qu·∫£ l√†m vi·ªác (v√≠ d·ª•: tƒÉng doanh s·ªë 20%, gi·∫£m chi ph√≠ 15%)</p>
                                </div>
                            </div>

                            <div class="criteria-item">
                                <label for="skills-weight">K·ªπ NƒÉng Chuy√™n M√¥n <small>(Tr·ªçng s·ªë hi·ªán t·∫°i: <b id="skills-percent">15%</b>)</small></label>
                                <div class="slider-container">
                                    <div class="slider-track"></div>
                                    <input type="range" min="5" max="50" value="15" class="weight-slider" id="skills-weight">
                                    <span class="weight-value" id="skills-value">15</span>
                                </div>
                                <div class="criteria-details">
                                    <p>ƒê√°nh gi√° s·ªë l∆∞·ª£ng k·ªπ nƒÉng li√™n quan, c√¥ng ngh·ªá v√† c√¥ng c·ª• m√† ·ª©ng vi√™n th√†nh th·∫°o</p>
                                </div>
                            </div>

                            <div class="criteria-item">
                                <label for="soft-skills-weight">K·ªπ nƒÉng m·ªÅm / Ph·∫©m ch·∫•t c√° nh√¢n <small>(Tr·ªçng s·ªë hi·ªán t·∫°i: <b id="soft-skills-percent">5%</b>)</small></label>
                                <div class="slider-container">
                                    <div class="slider-track"></div>
                                    <input type="range" min="5" max="30" value="5" class="weight-slider" id="soft-skills-weight">
                                    <span class="weight-value" id="soft-skills-value">5</span>
                                </div>
                                <div class="criteria-details">
                                    <p>ƒê√°nh gi√° k·ªπ nƒÉng m·ªÅm nh∆∞ l√†m vi·ªác nh√≥m, l√£nh ƒë·∫°o, giao ti·∫øp, th√≠ch nghi, v√† c√°c ho·∫°t ƒë·ªông th·ªÉ hi·ªán ph·∫©m ch·∫•t c√° nh√¢n</p>
                                </div>
                            </div>

                            <div class="criteria-item">
                                <label for="education-weight">H·ªçc V·∫•n <small>(Tr·ªçng s·ªë hi·ªán t·∫°i: <b id="education-percent">5%</b>)</small></label>
                                <div class="slider-container">
                                    <div class="slider-track"></div>
                                    <input type="range" min="5" max="30" value="5" class="weight-slider" id="education-weight">
                                    <span class="weight-value" id="education-value">5</span>
                                </div>
                                <div class="criteria-details">
                                    <p>ƒê√°nh gi√° b·∫±ng c·∫•p, chi ti·∫øt h·ªçc v·∫•n, th√†nh t√≠ch h·ªçc t·∫≠p v√† tr√¨nh ƒë·ªô ƒë·∫°i h·ªçc/cao h·ªçc</p>
                                </div>
                            </div>
                        </div>

                        <div class="weight-warning" id="weight-warning" style="display: none;">
                            <span class="material-symbols-outlined">warning</span>
                            <p>T·ªïng ƒëi·ªÉm ph√¢n b·ªï ph·∫£i b·∫±ng 100% ƒë·ªÉ ƒë·∫£m b·∫£o ƒë√°nh gi√° ch√≠nh x√°c!</p>
                        </div>

                        <div class="settings-actions">
                            <button class="btn btn-primary" id="save-weights">
                                <span class="material-symbols-outlined">save</span>
                                L∆∞u Thi·∫øt L·∫≠p
                            </button>
                            <button class="btn btn-secondary" id="reset-default-weights">
                                <span class="material-symbols-outlined">refresh</span>
                                Kh√¥i Ph·ª•c M·∫∑c ƒê·ªãnh
                            </button>
                        </div>
                    </div>

                    <div class="scoring-preview-section">
                        <div class="preview-header">
                            <h3>Xem Tr∆∞·ªõc</h3>
                            <p>Ph√¢n b·ªï m·ªõi</p>
                        </div>
                        
                        <div class="preview-chart-container">
                            <canvas id="weightChart"></canvas>
                        </div>
                        
                        <div class="preview-note">
                            <p><strong>L∆∞u √Ω:</strong> Thay ƒë·ªïi tr·ªçng s·ªë s·∫Ω ·∫£nh h∆∞·ªüng ƒë·∫øn t·∫•t c·∫£ CV trong h·ªá th·ªëng. ƒêi·ªÅu ch·ªânh ph√π h·ª£p s·∫Ω gi√∫p t√¨m ·ª©ng vi√™n ph√π h·ª£p h∆°n.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processing data...</p>
            </div>
        </div>
    </div>
    <!-- AI Recruitment Advisor Chatbot -->
    <button class="chatbot-toggle" id="chatbotToggle">
        ü§ñ
        <div class="notification-badge" id="notificationBadge" style="display: none;">1</div>
    </button>

    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <div class="chatbot-title">
                <span>üéØ</span>
                <div>
                    <div>AI T∆∞ V·∫•n Tuy·ªÉn D·ª•ng</div>
                    <div class="chatbot-status">
                        <div class="status-dot"></div>
                        <span>Tr·ª±c tuy·∫øn</span>
                    </div>
                </div>
            </div>
            <button class="chatbot-close" id="chatbotClose">√ó</button>
        </div>

        <div class="chatbot-messages" id="chatbotMessages">
            <div class="message bot">
                <div class="message-avatar">ü§ñ</div>
                <div>
                    <div class="message-content">
                        Xin ch√†o! T√¥i l√† AI T∆∞ V·∫•n Tuy·ªÉn D·ª•ng c·ªßa Tech CV. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:
                        
                        ‚Ä¢ Ph√¢n t√≠ch d·ªØ li·ªáu CV trong h·ªá th·ªëng
                        ‚Ä¢ ƒê·ªÅ xu·∫•t c√¢u h·ªèi ph·ªèng v·∫•n ph√π h·ª£p
                        ‚Ä¢ T∆∞ v·∫•n chi·∫øn l∆∞·ª£c tuy·ªÉn d·ª•ng
                        ‚Ä¢ So s√°nh m·ª©c l∆∞∆°ng th·ªã tr∆∞·ªùng
                        ‚Ä¢ ƒê∆∞a ra quy·∫øt ƒë·ªãnh tuy·ªÉn d·ª•ng t·ªëi ∆∞u
                        
                        B·∫°n c·∫ßn h·ªó tr·ª£ g√¨ h√¥m nay?
                    </div>
                    <div class="suggestion-chips">
                        <div class="suggestion-chip" data-suggestion="Ph√¢n t√≠ch d·ªØ li·ªáu CV hi·ªán t·∫°i">üìä Ph√¢n t√≠ch d·ªØ li·ªáu CV</div>
                        <div class="suggestion-chip" data-suggestion="Top ·ª©ng vi√™n xu·∫•t s·∫Øc nh·∫•t">üèÜ Top ·ª©ng vi√™n</div>
                        <div class="suggestion-chip" data-suggestion="Th·ªëng k√™ CV theo v·ªã tr√≠">üìà Th·ªëng k√™ v·ªã tr√≠</div>
                    </div>
                    <div class="message-time">V·ª´a xong</div>
                </div>
            </div>
        </div>

        <div class="chatbot-input">
            <div class="input-container">
                <textarea class="chatbot-textarea" id="chatbotInput" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." rows="1"></textarea>
                <button class="send-button" id="sendButton">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Configuration
        const GEMINI_API_KEY = 'AIzaSyBS_x_yc-j7yBoCksqiET3TlZZDPgVnrWU';
        const GEMINI_MODEL = 'gemini-1.5-flash-latest';
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;

        // Global variables
        let cvDatabase = [];
        let filteredCVs = [];
        let charts = {};

        // M·∫´u ti√™u ch√≠ ƒë√°nh gi√° theo ng√†nh ngh·ªÅ
        const industryTemplates = {
            'it-software': {
                name: 'C√¥ng Ngh·ªá Th√¥ng Tin / Ph·∫ßn M·ªÅm',
                criteria: {
                    'job-relevance': 30,    // K·ªπ nƒÉng l·∫≠p tr√¨nh, frameworks
                    'professionalism': 10,  // CV chuy√™n nghi·ªáp
                    'experience': 25,       // Kinh nghi·ªám d·ª± √°n
                    'achievements': 15,     // S·∫£n ph·∫©m, ƒë√≥ng g√≥p code
                    'skills': 15,           // Technical skills
                    'soft-skills': 3,       // Teamwork, communication
                    'education': 2          // B·∫±ng c·∫•p IT
                }
            },
            'marketing-sales': {
                name: 'Marketing / B√°n H√†ng',
                criteria: {
                    'job-relevance': 25,    // Kinh nghi·ªám marketing/sales
                    'professionalism': 15,  // Presentation skills
                    'experience': 20,       // Track record b√°n h√†ng
                    'achievements': 25,     // KPI, doanh s·ªë c·ª• th·ªÉ
                    'skills': 8,            // Tools: Google Analytics, CRM
                    'soft-skills': 5,       // Communication, persuasion
                    'education': 2          // Marketing/Business degree
                }
            },
            'finance-accounting': {
                name: 'T√†i Ch√≠nh / K·∫ø To√°n',
                criteria: {
                    'job-relevance': 25,    // Kinh nghi·ªám t√†i ch√≠nh
                    'professionalism': 20,  // T√≠nh ch√≠nh x√°c, chi ti·∫øt
                    'experience': 20,       // Kinh nghi·ªám ng√†nh
                    'achievements': 10,     // Ti·∫øt ki·ªám chi ph√≠, t·ªëi ∆∞u
                    'skills': 10,           // Excel, SAP, accounting software
                    'soft-skills': 5,       // Analytical thinking
                    'education': 10         // B·∫±ng c·∫•p t√†i ch√≠nh/k·∫ø to√°n
                }
            },
            'human-resources': {
                name: 'Nh√¢n S·ª± / Tuy·ªÉn D·ª•ng',
                criteria: {
                    'job-relevance': 25,    // Kinh nghi·ªám HR
                    'professionalism': 15,  // K·ªπ nƒÉng giao ti·∫øp
                    'experience': 20,       // Kinh nghi·ªám qu·∫£n l√Ω nh√¢n s·ª±
                    'achievements': 15,     // T·ª∑ l·ªá tuy·ªÉn d·ª•ng th√†nh c√¥ng
                    'skills': 8,            // HR tools, recruitment platforms
                    'soft-skills': 12,      // Leadership, empathy
                    'education': 5          // Psychology, HR degree
                }
            },
            'design-creative': {
                name: 'Thi·∫øt K·∫ø / S√°ng T·∫°o',
                criteria: {
                    'job-relevance': 25,    // Portfolio, design experience
                    'professionalism': 10,  // Presentation c·ªßa CV
                    'experience': 20,       // Kinh nghi·ªám thi·∫øt k·∫ø
                    'achievements': 25,     // Awards, featured projects
                    'skills': 15,           // Design software, tools
                    'soft-skills': 3,       // Creativity, collaboration
                    'education': 2          // Design/Art degree
                }
            },
            'engineering-manufacturing': {
                name: 'K·ªπ Thu·∫≠t / S·∫£n Xu·∫•t',
                criteria: {
                    'job-relevance': 30,    // Kinh nghi·ªám k·ªπ thu·∫≠t
                    'professionalism': 15,  // Technical documentation
                    'experience': 25,       // Kinh nghi·ªám ng√†nh
                    'achievements': 10,     // Process improvement
                    'skills': 12,           // CAD, technical tools
                    'soft-skills': 3,       // Problem-solving
                    'education': 5          // Engineering degree
                }
            },
            'healthcare-medical': {
                name: 'Y T·∫ø / ChƒÉm S√≥c S·ª©c Kh·ªèe',
                criteria: {
                    'job-relevance': 20,    // Kinh nghi·ªám y t·∫ø
                    'professionalism': 20,  // T√≠nh chuy√™n nghi·ªáp cao
                    'experience': 25,       // Kinh nghi·ªám l√¢m s√†ng
                    'achievements': 8,      // Nghi√™n c·ª©u, b√†i b√°o
                    'skills': 7,            // Medical equipment, software
                    'soft-skills': 10,      // Empathy, communication
                    'education': 10         // Medical degree, certifications
                }
            },
            'education-training': {
                name: 'Gi√°o D·ª•c / ƒê√†o T·∫°o',
                criteria: {
                    'job-relevance': 25,    // Kinh nghi·ªám gi·∫£ng d·∫°y
                    'professionalism': 15,  // K·ªπ nƒÉng truy·ªÅn ƒë·∫°t
                    'experience': 20,       // Kinh nghi·ªám gi√°o d·ª•c
                    'achievements': 15,     // Th√†nh t√≠ch h·ªçc sinh
                    'skills': 8,            // Teaching tools, LMS
                    'soft-skills': 12,      // Patience, communication
                    'education': 5          // Education degree
                }
            }
        };

        // CV Parsing Function using Gemini API
        async function parseCvUsingGemini(cvText) {
            // 1. Preprocess cvText: normalize whitespace and line breaks, ensure UTF-8 encoding
            const preprocessedText = cvText
                .replace(/\s+/g, ' ')  // normalize multiple spaces/tabs to single space
                .replace(/\n+/g, '\n') // normalize multiple line breaks to single line break
                .trim();

            // 2. Build Gemini API request with temperature=0 and strict JSON schema
            const prompt = `Analyze the following CV text and extract information in the exact JSON format specified below.

IMPORTANT: Return ONLY the JSON object, no additional text or explanation.

Example output format:
{
  "full_name": "Nguy·ªÖn VƒÉn A",
  "email": "nguyenvana@email.com",
  "phone": "0123456789",
  "education": [
    { "degree": "C·ª≠ nh√¢n C√¥ng ngh·ªá Th√¥ng tin", "school": "ƒê·∫°i h·ªçc B√°ch Khoa H√† N·ªôi", "year_range": "2018-2022" }
  ],
  "work_experience": [
    { "position": "Frontend Developer", "company": "FPT Software", "year_range": "2022-2024" }
  ]
}

CV Text to analyze:
${preprocessedText}

Extract the following information:
- full_name: Person's full name (string or null if not found)
- email: Email address (string or null if not found)
- phone: Phone number in Vietnamese format (string or null if not found)
- education: Array of education entries with degree, school, year_range (empty array if none found)
- work_experience: Array of work experience with position, company, year_range (empty array if none found)

Return the JSON object now:`;

            const requestBody = {
                contents: [{
                    parts: [{
                        text: prompt
                    }]
                }],
                generationConfig: {
                    temperature: 0,
                    maxOutputTokens: 1024
                }
            };

            try {
                // 3. Send the request and await response
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('Invalid API response structure');
                }

                const responseText = data.candidates[0].content.parts[0].text.trim();
                
                // Try to extract JSON from response (in case there's extra text)
                let jsonMatch = responseText.match(/\{[\s\S]*\}/);
                let jsonText = jsonMatch ? jsonMatch[0] : responseText;
                
                // Parse the JSON response
                let parsedData;
                try {
                    parsedData = JSON.parse(jsonText);
                } catch (parseError) {
                    throw new Error(`Failed to parse JSON response: ${parseError.message}`);
                }

                // 4. Fallback regex extraction for missing fields
                let result = {
                    full_name: parsedData.full_name || null,
                    email: parsedData.email || null,
                    phone: parsedData.phone || null,
                    education: Array.isArray(parsedData.education) ? parsedData.education : [],
                    work_experience: Array.isArray(parsedData.work_experience) ? parsedData.work_experience : []
                };

                // Fallback regex for email if missing
                if (!result.email) {
                    const emailRegex = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-z]{2,}/;
                    const emailMatch = preprocessedText.match(emailRegex);
                    if (emailMatch) {
                        result.email = emailMatch[0];
                    }
                }

                // Fallback regex for phone (Vietnamese format) if missing
                if (!result.phone) {
                    const phoneRegex = /\b0\d{9,10}\b/;
                    const phoneMatch = preprocessedText.match(phoneRegex);
                    if (phoneMatch) {
                        result.phone = phoneMatch[0];
                    }
                }

                // 5. Return the parsed object
                return result;

            } catch (error) {
                // If API call fails or JSON is invalid, return object with null/empty values
                return {
                    full_name: null,
                    email: null,
                    phone: null,
                    education: [],
                    work_experience: []
                };
            }
        }

        // Industry Template Functions
        function applyIndustryTemplate() {
            const selectedTemplate = document.getElementById('industry-template').value;
            
            if (!selectedTemplate) {
                alert('‚ö†Ô∏è Vui l√≤ng ch·ªçn m·ªôt ng√†nh ngh·ªÅ t·ª´ danh s√°ch');
                return;
            }

            const template = industryTemplates[selectedTemplate];
            if (!template) {
                alert('‚ùå Kh√¥ng t√¨m th·∫•y m·∫´u ti√™u ch√≠ cho ng√†nh n√†y');
                return;
            }

            // Apply template weights to sliders
            const criteria = template.criteria;
            
            // Update each slider and its display
            Object.keys(criteria).forEach(key => {
                const weight = criteria[key];
                const slider = document.getElementById(key + '-weight');
                const valueDisplay = document.getElementById(key + '-value');
                const percentDisplay = document.getElementById(key + '-percent');
                
                if (slider && valueDisplay && percentDisplay) {
                    slider.value = weight;
                    valueDisplay.textContent = weight;
                    percentDisplay.textContent = weight + '%';
                }
            });

            // Update total weight
            updateTotalWeight();
            
            // Show success message
            const templateName = template.name;
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                z-index: 10000;
                font-weight: 600;
                font-size: 0.9rem;
                animation: slideInRight 0.3s ease;
            `;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>‚úÖ</span>
                    <span>ƒê√£ √°p d·ª•ng m·∫´u ti√™u ch√≠: ${templateName}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function updateTotalWeight() {
            const sliders = document.querySelectorAll('.weight-slider');
            let total = 0;
            
            sliders.forEach(slider => {
                total += parseInt(slider.value) || 0;
            });
            
            const totalWeightElement = document.getElementById('total-weight');
            if (totalWeightElement) {
                totalWeightElement.textContent = total;
                totalWeightElement.style.color = total === 100 ? '#10b981' : '#ef4444';
            }
            
            // Show/hide warning
            const warning = document.getElementById('weight-warning');
            if (warning) {
                warning.style.display = total !== 100 ? 'flex' : 'none';
            }
        }

        // DOM Elements
        const navTabs = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const uploadArea = document.getElementById('upload-area');
        const cvFiles = document.getElementById('cv-files');
        const uploadProgress = document.getElementById('upload-progress');
        const progressBar = document.getElementById('progress-bar');
        const uploadStatus = document.getElementById('upload-status');
        const uploadResults = document.getElementById('upload-results');
        const resultsList = document.getElementById('results-list');
        const cvGrid = document.getElementById('cv-grid');
        const rankingList = document.getElementById('ranking-list');
        const loading = document.getElementById('loading');

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            createDemoData(); // T·∫°o d·ªØ li·ªáu demo
        });

        function createDemoData() {
            // T·∫°o m·ªôt s·ªë CV demo ƒë·ªÉ test
            const demoCVs = [
                {
                    id: 'demo-1',
                    filename: 'nguyen_van_a_frontend.pdf',
                    full_name: 'Nguy·ªÖn VƒÉn A',
                    email: 'nguyenvana@email.com',
                    phone: '0123456789',
                    position: 'Frontend Developer',
                    experience: '3 nƒÉm',
                    education: [
                        { degree: 'C·ª≠ nh√¢n C√¥ng ngh·ªá Th√¥ng tin', school: 'ƒê·∫°i h·ªçc B√°ch Khoa H√† N·ªôi', year_range: '2018-2022' }
                    ],
                    work_experience: [
                        { position: 'Frontend Developer', company: 'FPT Software', year_range: '2022-2024' },
                        { position: 'Intern Developer', company: 'VNG Corporation', year_range: '2021-2022' }
                    ],
                    skills: ['React', 'Vue.js', 'JavaScript', 'CSS', 'HTML'],
                    score: 85,
                    uploadDate: new Date('2024-12-01')
                },
                {
                    id: 'demo-2',
                    filename: 'tran_thi_b_marketing.pdf',
                    full_name: 'Tr·∫ßn Th·ªã B',
                    email: 'tranthib@email.com',
                    phone: '0987654321',
                    position: 'Marketing Manager',
                    experience: '5 nƒÉm',
                    education: [
                        { degree: 'C·ª≠ nh√¢n Qu·∫£n tr·ªã Kinh doanh', school: 'ƒê·∫°i h·ªçc Ngo·∫°i Th∆∞∆°ng', year_range: '2016-2020' }
                    ],
                    work_experience: [
                        { position: 'Marketing Manager', company: 'Shopee Vietnam', year_range: '2022-2024' },
                        { position: 'Digital Marketing Specialist', company: 'Lazada', year_range: '2020-2022' }
                    ],
                    skills: ['Google Analytics', 'Facebook Ads', 'SEO', 'Content Marketing'],
                    score: 92,
                    uploadDate: new Date('2024-12-02')
                },
                {
                    id: 'demo-3',
                    filename: 'le_van_c_design.pdf',
                    full_name: 'L√™ VƒÉn C',
                    email: 'levanc@email.com',
                    phone: '0369258147',
                    position: 'UI/UX Designer',
                    experience: '2 nƒÉm',
                    education: [
                        { degree: 'C·ª≠ nh√¢n Thi·∫øt k·∫ø ƒê·ªì h·ªça', school: 'ƒê·∫°i h·ªçc M·ªπ thu·∫≠t C√¥ng nghi·ªáp', year_range: '2019-2023' }
                    ],
                    work_experience: [
                        { position: 'UI/UX Designer', company: 'Tiki', year_range: '2023-2024' }
                    ],
                    skills: ['Figma', 'Adobe XD', 'Photoshop', 'Illustrator', 'Prototyping'],
                    score: 76,
                    uploadDate: new Date('2024-12-03')
                },
                {
                    id: 'demo-4',
                    filename: 'pham_thi_d_hr.pdf',
                    full_name: 'Ph·∫°m Th·ªã D',
                    email: 'phamthid@email.com',
                    phone: '0456789123',
                    position: 'HR Specialist',
                    experience: '4 nƒÉm',
                    education: [
                        { degree: 'C·ª≠ nh√¢n T√¢m l√Ω h·ªçc', school: 'ƒê·∫°i h·ªçc S∆∞ ph·∫°m H√† N·ªôi', year_range: '2017-2021' }
                    ],
                    work_experience: [
                        { position: 'HR Specialist', company: 'Samsung Vietnam', year_range: '2021-2024' }
                    ],
                    skills: ['Recruitment', 'Training & Development', 'HR Analytics', 'Labour Law'],
                    score: 68,
                    uploadDate: new Date('2024-12-04')
                },
                {
                    id: 'demo-5',
                    filename: 'vo_van_e_backend.pdf',
                    full_name: 'V√µ VƒÉn E',
                    email: 'vovane@email.com',
                    phone: '0789123456',
                    position: 'Backend Developer',
                    experience: '6 nƒÉm',
                    education: [
                        { degree: 'Th·∫°c sƒ© Khoa h·ªçc M√°y t√≠nh', school: 'ƒê·∫°i h·ªçc Qu·ªëc gia TP.HCM', year_range: '2015-2019' }
                    ],
                    work_experience: [
                        { position: 'Senior Backend Developer', company: 'Grab Vietnam', year_range: '2022-2024' },
                        { position: 'Backend Developer', company: 'ZaloPay', year_range: '2019-2022' }
                    ],
                    skills: ['Java', 'Spring Boot', 'MySQL', 'Redis', 'Microservices', 'Docker'],
                    score: 94,
                    uploadDate: new Date('2024-12-05')
                }
            ];

            // Add demo CVs to database
            cvDatabase = demoCVs;
            filteredCVs = [...cvDatabase];
            
            // Update displays
            updateStatistics();
            displayCVs(filteredCVs);
            updateRanking();
        }

        function initializeApp() {
            setupEventListeners();
            updateStatistics();
            createCharts();
            initializeWeightSliders();
        }

        function initializeWeightSliders() {
            // Initialize all weight sliders with default values
            const defaultWeights = {
                'job-relevance': 25,
                'professionalism': 15,
                'experience': 20,
                'achievements': 15,
                'skills': 15,
                'soft-skills': 5,
                'education': 5
            };

            Object.keys(defaultWeights).forEach(key => {
                const weight = defaultWeights[key];
                const slider = document.getElementById(key + '-weight');
                const valueDisplay = document.getElementById(key + '-value');
                const percentDisplay = document.getElementById(key + '-percent');
                
                if (slider && valueDisplay && percentDisplay) {
                    slider.value = weight;
                    valueDisplay.textContent = weight;
                    percentDisplay.textContent = weight + '%';
                }
            });

            updateTotalWeight();
        }

        function updateStatistics() {
            const total = cvDatabase.length;
            const excellent = cvDatabase.filter(cv => cv.score >= 80).length;
            const good = cvDatabase.filter(cv => cv.score >= 60 && cv.score < 80).length;
            const average = cvDatabase.filter(cv => cv.score >= 40 && cv.score < 60).length;
            
            // Update management tab stats
            const totalCvsElement = document.getElementById('total-cvs');
            if (totalCvsElement) {
                totalCvsElement.textContent = `${total} CV`;
            }
            
            // Update analytics tab stats
            const statElements = {
                'stat-total': total,
                'stat-excellent': excellent,
                'stat-good': good,
                'stat-average': average
            };
            
            Object.keys(statElements).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = statElements[id];
                }
            });
        }

        function displayCVs(cvs) {
            const cvGrid = document.getElementById('cv-grid');
            if (!cvGrid) return;

            if (cvs.length === 0) {
                cvGrid.innerHTML = `
                    <p style="text-align: center; color: #64748b; font-style: italic; padding: 2rem; grid-column: 1 / -1;">
                        üìÇ Kh√¥ng t√¨m th·∫•y CV n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc.
                    </p>
                `;
                return;
            }

            cvGrid.innerHTML = cvs.map(cv => `
                <div class="cv-card ${getScoreClass(cv.score)}">
                    <div class="cv-header">
                        <div class="cv-name">${cv.full_name}</div>
                        <div class="cv-score ${getScoreClass(cv.score, 'score')}">${cv.score}</div>
                    </div>
                    <div class="cv-details">
                        <div class="cv-detail">
                            <span class="material-symbols-outlined">work</span>
                            <span>${cv.position}</span>
                        </div>
                        <div class="cv-detail">
                            <span class="material-symbols-outlined">schedule</span>
                            <span>${cv.experience}</span>
                        </div>
                        <div class="cv-detail">
                            <span class="material-symbols-outlined">email</span>
                            <span>${cv.email}</span>
                        </div>
                        <div class="cv-detail">
                            <span class="material-symbols-outlined">phone</span>
                            <span>${cv.phone}</span>
                        </div>
                    </div>
                    <div class="cv-actions">
                        <button class="btn btn-small btn-primary" onclick="viewCVDetails('${cv.id}')">
                            <span class="material-symbols-outlined">visibility</span>
                            Xem
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="downloadCV('${cv.id}')">
                            <span class="material-symbols-outlined">download</span>
                            T·∫£i
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getScoreClass(score, type = 'card') {
            const prefix = type === 'score' ? 'score-' : '';
            if (score >= 80) return prefix + 'excellent';
            if (score >= 60) return prefix + 'good';
            if (score >= 40) return prefix + 'average';
            return prefix + 'poor';
        }

        function updateRanking() {
            const rankingTbody = document.getElementById('ranking-tbody');
            if (!rankingTbody) return;

            const sortedCVs = [...cvDatabase].sort((a, b) => b.score - a.score);
            
            rankingTbody.innerHTML = sortedCVs.map((cv, index) => `
                <tr>
                    <td class="rank-cell">
                        <div class="rank-badge rank-${index < 3 ? index + 1 : 'other'}">${index + 1}</div>
                    </td>
                    <td>
                        <div class="candidate-info">
                            <div class="candidate-avatar">${cv.full_name.charAt(0)}</div>
                            <div class="candidate-details">
                                <h4>${cv.full_name}</h4>
                                <p>${cv.email}</p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="position-badge">${cv.position}</span>
                    </td>
                    <td class="experience-cell">${cv.experience}</td>
                    <td class="score-cell">
                        <span class="score-badge ${getScoreClass(cv.score, 'score')}">${cv.score}</span>
                    </td>
                    <td class="actions-cell">
                        <div class="action-buttons">
                            <button class="action-btn primary" onclick="viewCVDetails('${cv.id}')">
                                <span class="material-symbols-outlined">visibility</span>
                                Xem
                            </button>
                            <button class="action-btn secondary" onclick="downloadCV('${cv.id}')">
                                <span class="material-symbols-outlined">download</span>
                                T·∫£i
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function viewCVDetails(cvId) {
            const cv = cvDatabase.find(c => c.id === cvId);
            if (!cv) return;
            
            alert(`üìã Chi ti·∫øt CV: ${cv.full_name}\n\n` +
                  `üìß Email: ${cv.email}\n` +
                  `üìû Phone: ${cv.phone}\n` +
                  `üíº V·ªã tr√≠: ${cv.position}\n` +
                  `‚è∞ Kinh nghi·ªám: ${cv.experience}\n` +
                  `‚≠ê ƒêi·ªÉm: ${cv.score}/100\n` +
                  `üéì H·ªçc v·∫•n: ${cv.education.map(e => e.degree).join(', ')}\n` +
                  `üîß K·ªπ nƒÉng: ${cv.skills.join(', ')}`);
        }

        function downloadCV(cvId) {
            const cv = cvDatabase.find(c => c.id === cvId);
            if (!cv) return;
            
            alert(`üì• T·∫£i CV: ${cv.filename}\n\n(Demo: T√≠nh nƒÉng t·∫£i CV s·∫Ω ƒë∆∞·ª£c tri·ªÉn khai trong phi√™n b·∫£n th·∫≠t)`);
        }

        function createCharts() {
            // Chart creation will be implemented later
            console.log('Charts initialized');
        }

        function applyFilters() {
            const keyword = document.getElementById('search-keyword')?.value.toLowerCase() || '';
            const scoreFilter = document.getElementById('score-filter')?.value || '';
            
            filteredCVs = cvDatabase.filter(cv => {
                const matchesKeyword = !keyword || 
                    cv.full_name.toLowerCase().includes(keyword) ||
                    cv.position.toLowerCase().includes(keyword) ||
                    cv.email.toLowerCase().includes(keyword) ||
                    cv.skills.some(skill => skill.toLowerCase().includes(keyword));
                
                const matchesScore = !scoreFilter || getScoreClass(cv.score).includes(scoreFilter);
                
                return matchesKeyword && matchesScore;
            });
            
            displayCVs(filteredCVs);
            updateStatistics();
        }

        function resetFilters() {
            document.getElementById('search-keyword').value = '';
            document.getElementById('score-filter').value = '';
            filteredCVs = [...cvDatabase];
            displayCVs(filteredCVs);
            updateStatistics();
        }

        // Chatbot Functions
        function sendMessage(message = null) {
            const textarea = document.getElementById('chatbotTextarea');
            const text = message || textarea.value.trim();
            
            if (!text) return;
            
            // Add user message
            addChatMessage(text, 'user');
            
            // Clear input
            if (!message) textarea.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const response = generateAIResponse(text);
                addChatMessage(response, 'bot');
            }, 1000);
        }

        function addChatMessage(text, sender) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const time = new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
            
            const messageHTML = `
                <div class="message ${sender}">
                    <div class="message-avatar">${sender === 'bot' ? 'ü§ñ' : 'üë§'}</div>
                    <div>
                        <div class="message-content">${text}</div>
                        <div class="message-time">${time}</div>
                    </div>
                </div>
            `;
            
            messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateAIResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('ph√¢n t√≠ch') || message.includes('d·ªØ li·ªáu')) {
                const total = cvDatabase.length;
                const avgScore = Math.round(cvDatabase.reduce((sum, cv) => sum + cv.score, 0) / total);
                return `üìä **Ph√¢n t√≠ch d·ªØ li·ªáu CV hi·ªán t·∫°i:**\n\n‚Ä¢ T·ªïng CV: ${total}\n‚Ä¢ ƒêi·ªÉm trung b√¨nh: ${avgScore}/100\n‚Ä¢ CV xu·∫•t s·∫Øc (‚â•80): ${cvDatabase.filter(cv => cv.score >= 80).length}\n‚Ä¢ CV t·ªët (60-79): ${cvDatabase.filter(cv => cv.score >= 60 && cv.score < 80).length}\n\nüí° **ƒê·ªÅ xu·∫•t:** N√™n t·∫≠p trung v√†o c√°c CV c√≥ ƒëi·ªÉm ‚â•70 ƒë·ªÉ c√≥ ·ª©ng vi√™n ch·∫•t l∆∞·ª£ng cao.`;
            }
            
            if (message.includes('top') || message.includes('xu·∫•t s·∫Øc')) {
                const topCVs = cvDatabase.sort((a, b) => b.score - a.score).slice(0, 3);
                const topList = topCVs.map((cv, i) => `${i+1}. **${cv.full_name}** - ${cv.position} (${cv.score} ƒëi·ªÉm)`).join('\n');
                return `üèÜ **Top 3 ·ª©ng vi√™n xu·∫•t s·∫Øc nh·∫•t:**\n\n${topList}\n\nüí° **ƒê·ªÅ xu·∫•t:** N√™n ∆∞u ti√™n ph·ªèng v·∫•n nh·ªØng ·ª©ng vi√™n n√†y tr∆∞·ªõc.`;
            }
            
            if (message.includes('v·ªã tr√≠') || message.includes('th·ªëng k√™')) {
                const positions = {};
                cvDatabase.forEach(cv => {
                    positions[cv.position] = (positions[cv.position] || 0) + 1;
                });
                const positionList = Object.entries(positions).map(([pos, count]) => `‚Ä¢ ${pos}: ${count} CV`).join('\n');
                return `üìà **Th·ªëng k√™ CV theo v·ªã tr√≠:**\n\n${positionList}\n\nüí° **ƒê·ªÅ xu·∫•t:** C√≥ th·ªÉ m·ªü th√™m v√≤ng tuy·ªÉn d·ª•ng cho c√°c v·ªã tr√≠ c√≥ nhi·ªÅu ·ª©ng vi√™n ch·∫•t l∆∞·ª£ng.`;
            }
            
            if (message.includes('ti√™u ch√≠') || message.includes('c·∫£i thi·ªán')) {
                return `‚öôÔ∏è **ƒê·ªÅ xu·∫•t c·∫£i thi·ªán ti√™u ch√≠ ƒë√°nh gi√°:**\n\n‚Ä¢ TƒÉng tr·ªçng s·ªë "Kinh nghi·ªám" l√™n 25-30% cho v·ªã tr√≠ senior\n‚Ä¢ TƒÉng tr·ªçng s·ªë "K·ªπ nƒÉng chuy√™n m√¥n" cho v·ªã tr√≠ technical\n‚Ä¢ TƒÉng tr·ªçng s·ªë "Th√†nh t·ª±u" cho v·ªã tr√≠ sales/marketing\n\nüí° B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng m·∫´u ti√™u ch√≠ theo ng√†nh trong tab "T√πy Ch·ªânh Ti√™u Ch√≠".`;
            }
            
            return `ü§ñ C·∫£m ∆°n b·∫°n ƒë√£ h·ªèi! T√¥i hi·ªÉu b·∫°n mu·ªën bi·∫øt v·ªÅ "${userMessage}". \n\nüìã T√¥i c√≥ th·ªÉ h·ªó tr·ª£ b·∫°n v·ªõi:\n‚Ä¢ Ph√¢n t√≠ch d·ªØ li·ªáu CV\n‚Ä¢ Top ·ª©ng vi√™n xu·∫•t s·∫Øc\n‚Ä¢ Th·ªëng k√™ theo v·ªã tr√≠\n‚Ä¢ C·∫£i thi·ªán ti√™u ch√≠ ƒë√°nh gi√°\n\nH√£y h·ªèi c·ª• th·ªÉ h∆°n ƒë·ªÉ t√¥i c√≥ th·ªÉ h·ªó tr·ª£ t·ªët nh·∫•t! üòä`;
        }

        // Chatbot toggle
        document.addEventListener('DOMContentLoaded', function() {
            const chatbotToggle = document.getElementById('chatbotToggle');
            const chatbotContainer = document.getElementById('chatbotContainer');
            const chatbotClose = document.getElementById('chatbotClose');
            
            chatbotToggle?.addEventListener('click', () => {
                chatbotContainer?.classList.add('open');
            });
            
            chatbotClose?.addEventListener('click', () => {
                chatbotContainer?.classList.remove('open');
            });
            
            // Handle suggestion chips
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('suggestion-chip')) {
                    const suggestion = e.target.textContent.trim();
                    sendMessage(suggestion);
                }
            });
            
            // Handle enter key in textarea
            document.getElementById('chatbotTextarea')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        });

        function setupEventListeners() {
            // Tab navigation
            navTabs.forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            // File upload
            uploadArea.addEventListener('click', () => cvFiles.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            cvFiles.addEventListener('change', handleFileUpload);

            // Filters
            document.getElementById('apply-filters').addEventListener('click', applyFilters);
            document.getElementById('reset-filters').addEventListener('click', resetFilters);

            // Search on input change
            document.getElementById('search-keyword').addEventListener('input', applyFilters);

            // Weight sliders
            const weightSliders = document.querySelectorAll('.weight-slider');
            weightSliders.forEach(slider => {
                slider.addEventListener('input', (e) => {
                    const value = e.target.value;
                    const id = e.target.id;
                    const valueDisplay = document.getElementById(id.replace('-weight', '-value'));
                    const percentDisplay = document.getElementById(id.replace('-weight', '-percent'));
                    
                    if (valueDisplay) valueDisplay.textContent = value;
                    if (percentDisplay) percentDisplay.textContent = value + '%';
                    
                    updateTotalWeight();
                });
            });
        }

        function switchTab(tabName) {
            // Update tab buttons
            navTabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });

            // Update tab content
            tabContents.forEach(content => {
                content.classList.toggle('active', content.id === `${tabName}-tab`);
            });

            // Update data when switching to certain tabs
            if (tabName === 'manage') {
                displayCVs(cvDatabase);
            } else if (tabName === 'analytics') {
                updateRanking();
                updateStatistics();
                updateCharts();
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.style.borderColor = '#667eea';
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.style.borderColor = '#e2e8f0';
            const files = Array.from(e.dataTransfer.files);
            processFiles(files);
        }

        function handleFileUpload(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }

        async function processFiles(files) {
            if (files.length === 0) return;

            // Validate files
            const validFiles = files.filter(file => validateFile(file));
            if (validFiles.length === 0) {
                alert('Kh√¥ng c√≥ file h·ª£p l·ªá ƒë·ªÉ x·ª≠ l√Ω!');
                return;
            }

            // Show progress
            uploadProgress.style.display = 'block';
            uploadResults.style.display = 'none';
            loading.classList.add('show');

            const results = [];
            const totalFiles = validFiles.length;

            for (let i = 0; i < validFiles.length; i++) {
                const file = validFiles[i];
                const progress = ((i + 1) / totalFiles) * 100;
                
                progressBar.style.width = `${progress}%`;
                uploadStatus.textContent = `ƒêang x·ª≠ l√Ω file ${i + 1}/${totalFiles}: ${file.name}`;

                try {
                    const cvData = await analyzeCVFile(file);
                    cvDatabase.push(cvData);
                    results.push({ file: file.name, status: 'success', data: cvData });
                } catch (error) {
                    console.error('Error processing file:', file.name, error);
                    results.push({ file: file.name, status: 'error', error: error.message });
                }

                // Small delay to show progress
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            // Hide progress and show results
            uploadProgress.style.display = 'none';
            loading.classList.remove('show');
            displayUploadResults(results);
            updateStatistics();
            updateRanking();
            updateCharts();
        }

        function validateFile(file) {
            const allowedTypes = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'image/jpeg',
                'image/jpg',
                'image/png'
            ];
            
            const allowedExtensions = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png'];
            const fileExtension = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));
            
            if (!allowedTypes.includes(file.type) && !allowedExtensions.includes(fileExtension)) {
                alert(`File ${file.name} kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£. Vui l√≤ng ch·ªçn file PDF, DOC, DOCX, JPG ho·∫∑c PNG`);
                return false;
            }
            
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                alert(`File ${file.name} qu√° l·ªõn. Vui l√≤ng ch·ªçn file nh·ªè h∆°n 10MB`);
                return false;
            }
            
            return true;
        }

        async function analyzeCVFile(file) {
            try {
                // 1. Read the actual CV content from file
                const cvText = await readCVContent(file);
                
                // 2. Parse CV using Gemini AI
                const parsedData = await parseCvUsingGemini(cvText);
                
                // 3. Calculate score using fixed formula instead of AI
                const analysis = calculateCVScore(cvText, parsedData);
                
                // 4. Build complete CV data object
                return {
                    id: Date.now() + Math.random(),
                    fileName: file.name,
                    name: parsedData.full_name || 'Kh√¥ng x√°c ƒë·ªãnh',
                    email: parsedData.email || null,
                    phone: parsedData.phone || null,
                    education: parsedData.education,
                    work_experience: parsedData.work_experience,
                    position: detectPosition(cvText, parsedData.work_experience),
                    experience: calculateExperience(parsedData.work_experience),
                    score: analysis.score,
                    breakdown: analysis.breakdown, // L∆∞u chi ti·∫øt ƒëi·ªÉm s·ªë
                    reason: analysis.reason,      // L∆∞u l√Ω do ƒëi·ªÉm s·ªë
                    skills: extractSkills(cvText),
                    uploadDate: new Date(),
                    status: analysis.score >= 90 ? 'excellent' : analysis.score >= 80 ? 'good' : analysis.score >= 70 ? 'average' : 'poor',
                    rawText: cvText
                };
            } catch (error) {
                console.error('Error analyzing CV:', error);
                throw error;
            }
        }

        // Function to read CV content from different file types
        async function readCVContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                if (file.type.startsWith('image/')) {
                    // For image files, try to extract text using OCR (Vision API or fallback)
                    reader.onload = async (e) => {
                        try {
                            // Try to use Google Vision API for OCR
                            const base64Data = e.target.result.split(',')[1];
                            const ocrText = await extractTextFromImage(base64Data);
                            
                            if (ocrText && ocrText.trim().length > 50) {
                                resolve(ocrText);
                            } else {
                                // Fallback: Ask user to manually enter or use different file
                                const userText = prompt(`File ·∫£nh "${file.name}" c·∫ßn ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi th√†nh vƒÉn b·∫£n.\n\nVui l√≤ng nh·∫≠p n·ªôi dung CV t·ª´ ·∫£nh n√†y (ho·∫∑c h·ªßy ƒë·ªÉ s·ª≠ d·ª•ng file kh√°c):`);
                                
                                if (userText && userText.trim().length > 0) {
                                    resolve(userText.trim());
                                } else {
                                    resolve(`CV t·ª´ file ·∫£nh: ${file.name}\n[C·∫ßn nh·∫≠p th·ªß c√¥ng ho·∫∑c s·ª≠ d·ª•ng file PDF/Word ƒë·ªÉ ƒë·ªçc t·ª± ƒë·ªông]`);
                                }
                            }
                        } catch (error) {
                            console.error('OCR Error:', error);
                            // Fallback for image files
                            const userText = prompt(`Kh√¥ng th·ªÉ ƒë·ªçc t·ª± ƒë·ªông file ·∫£nh "${file.name}".\n\nVui l√≤ng nh·∫≠p n·ªôi dung CV t·ª´ ·∫£nh n√†y:`);
                            
                            if (userText && userText.trim().length > 0) {
                                resolve(userText.trim());  
                            } else {
                                resolve(`CV t·ª´ file ·∫£nh: ${file.name}\n[C·∫ßn nh·∫≠p th·ªß c√¥ng ƒë·ªÉ ph√¢n t√≠ch ch√≠nh x√°c]`);
                            }
                        }
                    };
                    reader.readAsDataURL(file);
                    
                } else if (file.type === 'application/pdf') {
                    // For PDF files, try to extract text
                    reader.onload = async (e) => {
                        try {
                            // Try to use PDF.js or similar library for text extraction
                            const pdfText = await extractTextFromPDF(e.target.result);
                            
                            if (pdfText && pdfText.trim().length > 50) {
                                resolve(pdfText);
                            } else {
                                // Fallback: Ask user to provide content
                                const userText = prompt(`File PDF "${file.name}" kh√¥ng th·ªÉ ƒë·ªçc t·ª± ƒë·ªông.\n\nVui l√≤ng nh·∫≠p n·ªôi dung CV t·ª´ PDF n√†y (ho·∫∑c h·ªßy ƒë·ªÉ s·ª≠ d·ª•ng file kh√°c):`);
                                
                                if (userText && userText.trim().length > 0) {
                                    resolve(userText.trim());
                                } else {
                                    resolve(`CV t·ª´ file PDF: ${file.name}\n[C·∫ßn nh·∫≠p th·ªß c√¥ng ƒë·ªÉ ph√¢n t√≠ch ch√≠nh x√°c]`);
                                }
                            }
                        } catch (error) {
                            console.error('PDF Reading Error:', error);
                            // Fallback for PDF files
                            const userText = prompt(`Kh√¥ng th·ªÉ ƒë·ªçc t·ª± ƒë·ªông file PDF "${file.name}".\n\nVui l√≤ng nh·∫≠p n·ªôi dung CV t·ª´ PDF n√†y:`);
                            
                            if (userText && userText.trim().length > 0) {
                                resolve(userText.trim());
                            } else {
                                resolve(`CV t·ª´ file PDF: ${file.name}\n[C·∫ßn nh·∫≠p th·ªß c√¥ng ƒë·ªÉ ph√¢n t√≠ch ch√≠nh x√°c]`);
                            }
                        }
                    };
                    reader.readAsArrayBuffer(file);
                    
                } else {
                    // For DOC/DOCX and plain text files
                    reader.onload = (e) => {
                        const result = e.target.result;
                        
                        if (typeof result === 'string' && result.trim().length > 0) {
                            // Successfully read as text
                            resolve(result);
                        } else {
                            // For binary DOC files, ask user to provide content
                            const userText = prompt(`File "${file.name}" c·∫ßn ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi th√†nh vƒÉn b·∫£n.\n\nVui l√≤ng nh·∫≠p n·ªôi dung CV t·ª´ file n√†y (ho·∫∑c h·ªßy ƒë·ªÉ s·ª≠ d·ª•ng file kh√°c):`);
                            
                            if (userText && userText.trim().length > 0) {
                                resolve(userText.trim());
                            } else {
                                resolve(`CV t·ª´ file: ${file.name}\n[C·∫ßn nh·∫≠p th·ªß c√¥ng ƒë·ªÉ ph√¢n t√≠ch ch√≠nh x√°c]`);
                            }
                        }
                    };
                                        reader.readAsText(file, 'UTF-8');
                }
                
                reader.onerror = reject;
            });
        }

        // Helper function to extract text from images using OCR
        async function extractTextFromImage(base64Data) {
            try {
                // Option 1: Use Google Vision API (if available)
                const response = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        requests: [{
                            image: { content: base64Data },
                            features: [{ type: 'TEXT_DETECTION', maxResults: 1 }]
                        }]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.responses && data.responses[0].textAnnotations) {
                        return data.responses[0].textAnnotations[0].description;
                    }
                }
            } catch (error) {
                console.error('Vision API Error:', error);
            }
            
            // Option 2: Use Gemini API for image analysis
            try {
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: "Extract all text content from this CV image. Return only the plain text content without any formatting or explanations." },
                                { inline_data: { mime_type: "image/jpeg", data: base64Data } }
                            ]
                        }],
                        generationConfig: { temperature: 0, maxOutputTokens: 2048 }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                }
            } catch (error) {
                console.error('Gemini OCR Error:', error);
            }
            
            return null;
        }
        
        // Helper function to extract text from PDF files  
        async function extractTextFromPDF(arrayBuffer) {
            try {
                // Option 1: Use PDF.js library if available
                if (typeof pdfjsLib !== 'undefined') {
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    let fullText = '';
                    
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        fullText += pageText + '\n';
                    }
                    
                    return fullText.trim();
                }
            } catch (error) {
                console.error('PDF.js Error:', error);
            }
            
            // Option 2: Convert to base64 and use Gemini API
            try {
                const base64Data = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: "Extract all text content from this PDF document. Return only the plain text content without any formatting or explanations." },
                                { inline_data: { mime_type: "application/pdf", data: base64Data } }
                            ]
                        }],
                        generationConfig: { temperature: 0, maxOutputTokens: 2048 }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                }
            } catch (error) {
                console.error('Gemini PDF Error:', error);
            }
            
            return null;
        }

        // Function to calculate CV score using custom weights or default formula
        function calculateCVScore(cvText, parsedData) {
            let score = 0;
            
            // Get custom scoring weights from localStorage or use defaults
            const weights = getScoringWeights();
            
            let breakdown = {
                jobRelevance: 0,       // Default: 50 ƒëi·ªÉm max
                professionalism: 0,    // Default: 30 ƒëi·ªÉm max
                experience: 0,         // Default: 40 ƒëi·ªÉm max  
                achievements: 0,       // Default: 30 ƒëi·ªÉm max
                skills: 0,             // Default: 30 ƒëi·ªÉm max
                softSkills: 0,         // Default: 20 ƒëi·ªÉm max
                education: 0           // Default: 30 ƒëi·ªÉm max
            };

            // 1. ƒêI·ªÇM CHUY√äN NGHI·ªÜP V√Ä R√ï R√ÄNG
            const professionalismMax = weights.professionalism;
            let professionalismScore = 0;
            
            // C√≥ email (20% c·ªßa tr·ªçng s·ªë)
            if (parsedData.email) professionalismScore += professionalismMax * 0.2;
            
            // C√≥ s·ªë ƒëi·ªán tho·∫°i (20% c·ªßa tr·ªçng s·ªë)
            if (parsedData.phone) professionalismScore += professionalismMax * 0.2;
            
            // C√≥ h·ªç t√™n ƒë·∫ßy ƒë·ªß (20% c·ªßa tr·ªçng s·ªë)
            if (parsedData.full_name && parsedData.full_name.length > 5) professionalismScore += professionalismMax * 0.2;
            
            // CV c√≥ c·∫•u tr√∫c t·ªët - check keywords (20% c·ªßa tr·ªçng s·ªë)
            const structureKeywords = ['h·ªçc v·∫•n', 'kinh nghi·ªám', 'k·ªπ nƒÉng', 'th√¥ng tin', 'li√™n h·ªá', 'education', 'experience', 'skills'];
            const foundStructure = structureKeywords.filter(keyword => 
                cvText.toLowerCase().includes(keyword.toLowerCase())).length;
            if (foundStructure >= 3) professionalismScore += professionalismMax * 0.2;
            
            // CV ƒë·ªß d√†i v√† chi ti·∫øt (20% c·ªßa tr·ªçng s·ªë)
            if (cvText.length > 500) professionalismScore += professionalismMax * 0.2;
            
            breakdown.professionalism = Math.min(professionalismMax, professionalismScore);

            // 2. ƒêI·ªÇM KINH NGHI·ªÜM
            const experienceMax = weights.experience;
            let experienceScore = 0;
            
            if (parsedData.work_experience && parsedData.work_experience.length > 0) {
                // C√≥ √≠t nh·∫•t 1 kinh nghi·ªám (33% c·ªßa tr·ªçng s·ªë)
                experienceScore += experienceMax * 0.33;
                
                // M·ªói kinh nghi·ªám th√™m (50% c·ªßa tr·ªçng s·ªë, chia theo s·ªë l∆∞·ª£ng)
                const additionalExpWeight = experienceMax * 0.5;
                experienceScore += Math.min(additionalExpWeight, (parsedData.work_experience.length - 1) * (additionalExpWeight / 3));
                
                // Kinh nghi·ªám c√≥ m√¥ t·∫£ chi ti·∫øt (17% c·ªßa tr·ªçng s·ªë)
                const hasDetailedExp = parsedData.work_experience.some(exp => 
                    exp.position && exp.company && exp.year_range);
                if (hasDetailedExp) experienceScore += experienceMax * 0.17;
            }
            
            breakdown.experience = Math.min(experienceMax, experienceScore);

            // 3. ƒêI·ªÇM K·ª∏ NƒÇNG
            const skillsMax = weights.skills;
            let skillsScore = 0;
            
            const skillKeywords = [
                // Programming languages
                'javascript', 'python', 'java', 'c++', 'c#', 'php', 'ruby', 'go', 'swift', 'kotlin',
                // Frontend
                'react', 'vue', 'angular', 'html', 'css', 'bootstrap', 'tailwind',
                // Backend  
                'node.js', 'express', 'django', 'flask', 'spring', 'laravel',
                // Database
                'mysql', 'postgresql', 'mongodb', 'redis', 'sqlite',
                // Tools
                'git', 'docker', 'kubernetes', 'aws', 'azure', 'jenkins',
                // Design
                'photoshop', 'figma', 'sketch', 'adobe', 'ui/ux'
            ];
            
            const foundSkills = skillKeywords.filter(skill => 
                cvText.toLowerCase().includes(skill.toLowerCase())).length;
            
            // K·ªπ nƒÉng chi·∫øm 80% c·ªßa tr·ªçng s·ªë, m·ªói k·ªπ nƒÉng c√≥ gi√° tr·ªã b·∫±ng nhau (t·ªëi ƒëa 10 k·ªπ nƒÉng)
            const skillsWeightPortion = skillsMax * 0.8;
            skillsScore += Math.min(skillsWeightPortion, foundSkills * (skillsWeightPortion / 10));
            
            // C√≥ m·ª•c k·ªπ nƒÉng ri√™ng bi·ªát (20% c·ªßa tr·ªçng s·ªë)
            if (cvText.toLowerCase().includes('k·ªπ nƒÉng') || cvText.toLowerCase().includes('skills')) {
                skillsScore += skillsMax * 0.2;
            }
            
            breakdown.skills = Math.min(skillsMax, skillsScore);

            // 4. ƒêI·ªÇM H·ªåC V·∫§N
            const educationMax = weights.education;
            let educationScore = 0;
            
            if (parsedData.education && parsedData.education.length > 0) {
                // C√≥ √≠t nh·∫•t 1 b·∫±ng c·∫•p (50% c·ªßa tr·ªçng s·ªë)
                educationScore += educationMax * 0.5;
                
                // B·∫±ng c·∫•p c√≥ th√¥ng tin chi ti·∫øt (25% c·ªßa tr·ªçng s·ªë)
                const hasDetailedEdu = parsedData.education.some(edu => 
                    edu.degree && edu.school && edu.year_range);
                if (hasDetailedEdu) educationScore += educationMax * 0.25;
                
                // B·∫±ng ƒë·∫°i h·ªçc/cao h·ªçc (25% c·ªßa tr·ªçng s·ªë)
                const hasHigherEdu = parsedData.education.some(edu => 
                    edu.degree && (
                        edu.degree.toLowerCase().includes('ƒë·∫°i h·ªçc') ||
                        edu.degree.toLowerCase().includes('c·ª≠ nh√¢n') ||
                        edu.degree.toLowerCase().includes('k·ªπ s∆∞') ||
                        edu.degree.toLowerCase().includes('th·∫°c sƒ©') ||
                        edu.degree.toLowerCase().includes('bachelor') ||
                        edu.degree.toLowerCase().includes('master')
                    ));
                if (hasHigherEdu) educationScore += educationMax * 0.25;
            }
            
            breakdown.education = Math.min(educationMax, educationScore);

            // 5. ƒêI·ªÇM M·ª®C ƒê·ªò PH√ô H·ª¢P V·ªöI V·ªä TR√ç (Job Relevance)
            const jobRelevanceMax = weights.jobRelevance;
            let jobRelevanceScore = 0;
            
            // Logic ƒë√°nh gi√° ph√π h·ª£p v·ªõi v·ªã tr√≠ (m√¥ ph·ªèng, trong ·ª©ng d·ª•ng th·ª±c t·∫ø s·∫Ω c·∫ßn JD ƒë·ªÉ so s√°nh)
            // Gi·∫£ ƒë·ªãnh c√≥ m·ªôt s·ªë t·ª´ kh√≥a c·ªßa JD ƒë·ªÉ so s√°nh
            const jobPositionKeywords = ['developer', 'l·∫≠p tr√¨nh vi√™n', 'k·ªπ s∆∞ ph·∫ßn m·ªÅm', 'product manager', 'ui/ux', 
                                       'marketing', 'sales', 'nh√¢n s·ª±', 't√†i ch√≠nh', 'k·∫ø to√°n'];
            
            // T√¨m t·ª´ kh√≥a v·ªã tr√≠ trong CV (30% c·ªßa tr·ªçng s·ªë)
            const foundPositionKeywords = jobPositionKeywords.filter(keyword => 
                cvText.toLowerCase().includes(keyword.toLowerCase())).length;
            jobRelevanceScore += Math.min(jobRelevanceMax * 0.3, foundPositionKeywords * (jobRelevanceMax * 0.15));
            
            // Ki·ªÉm tra xem kinh nghi·ªám l√†m vi·ªác c√≥ ph√π h·ª£p v·ªõi v·ªã tr√≠ (40% c·ªßa tr·ªçng s·ªë)
            if (parsedData.work_experience && parsedData.work_experience.length > 0) {
                // Ki·ªÉm tra s·ªë nƒÉm kinh nghi·ªám (gi·∫£ ƒë·ªãnh y√™u c·∫ßu 2+ nƒÉm)
                let hasRelevantExp = parsedData.work_experience.some(exp => {
                    if (exp.year_range) {
                        // Ph√¢n t√≠ch th·ªùi gian l√†m vi·ªác (gi·∫£ ƒë·ªãnh ƒë·ªãnh d·∫°ng "2018-2022" ho·∫∑c "2018-present")
                        const years = exp.year_range.split('-');
                        if (years.length === 2) {
                            const start = parseInt(years[0]);
                            const end = years[1].toLowerCase() === 'present' ? new Date().getFullYear() : parseInt(years[1]);
                            if (!isNaN(start) && !isNaN(end) && (end - start) >= 2) {
                                return true;
                            }
                        }
                    }
                    return false;
                });
                
                if (hasRelevantExp) jobRelevanceScore += jobRelevanceMax * 0.4;
            }
            
            // C√°c k·ªπ nƒÉng c·ªët l√µi cho v·ªã tr√≠ (30% c·ªßa tr·ªçng s·ªë)
            // Gi·∫£ ƒë·ªãnh m·ªôt s·ªë k·ªπ nƒÉng c·ªët l√µi (th·ª±c t·∫ø s·∫Ω d·ª±a v√†o JD)
            const coreSkillsKeywords = ['javascript', 'react', 'node.js', 'sql', 'java', 'python', 'marketing', 'sales', 'communication'];
            const foundCoreSkills = coreSkillsKeywords.filter(skill => 
                cvText.toLowerCase().includes(skill.toLowerCase())).length;
            jobRelevanceScore += Math.min(jobRelevanceMax * 0.3, foundCoreSkills * (jobRelevanceMax * 0.1));
            
            breakdown.jobRelevance = Math.min(jobRelevanceMax, jobRelevanceScore);

            // 6. ƒêI·ªÇM TH√ÄNH T·ª∞U V√Ä K·∫æT QU·∫¢ (Achievements)
            const achievementsMax = weights.achievements;
            let achievementsScore = 0;
            
            // T√¨m c√°c ch·ªâ s·ªë ƒë·ªãnh l∆∞·ª£ng (%, con s·ªë, tƒÉng tr∆∞·ªüng, gi·∫£m chi ph√≠, v.v.) (50% c·ªßa tr·ªçng s·ªë)
            const quantifiableRegex = /\d+(\.\d+)?%|\btƒÉng\b.*\d+|\bgi·∫£m\b.*\d+|\bho√†n th√†nh\b|\bth√†nh c√¥ng\b|\bgold\b|\baward\b|\bgi·∫£i th∆∞·ªüng\b/gi;
            const quantifiableMatches = cvText.match(quantifiableRegex) || [];
            achievementsScore += Math.min(achievementsMax * 0.5, quantifiableMatches.length * (achievementsMax * 0.1));
            
            // C√°c d·ª± √°n ƒë·∫∑c bi·ªát/gi·∫£i th∆∞·ªüng (30% c·ªßa tr·ªçng s·ªë)
            const projectRegex = /\bd·ª± √°n\b|\bproject\b|\bgi·∫£i th∆∞·ªüng\b|\baward\b|\bcertificat/gi;
            const projectMatches = cvText.match(projectRegex) || [];
            achievementsScore += Math.min(achievementsMax * 0.3, projectMatches.length * (achievementsMax * 0.1));
            
            // Vai tr√≤ l√£nh ƒë·∫°o (20% c·ªßa tr·ªçng s·ªë) 
            const leadershipRegex = /\bl√£nh ƒë·∫°o\b|\bqu·∫£n l√Ω\b|\bteam lead\b|\bmanager\b|\bhead\b|\blead\b|\btr∆∞·ªüng\b|\bmanage\b/gi;
            const leadershipMatches = cvText.match(leadershipRegex) || [];
            if (leadershipMatches.length > 0) achievementsScore += achievementsMax * 0.2;
            
            breakdown.achievements = Math.min(achievementsMax, achievementsScore);

            // 7. ƒêI·ªÇM K·ª∏ NƒÇNG M·ªÄM (Soft Skills)
            const softSkillsMax = weights.softSkills;
            let softSkillsScore = 0;
            
            // Danh s√°ch c√°c k·ªπ nƒÉng m·ªÅm ph·ªï bi·∫øn
            const softSkillKeywords = [
                'giao ti·∫øp', 'communication', 'teamwork', 'l√†m vi·ªác nh√≥m', 'leadership', 'l√£nh ƒë·∫°o',
                'gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ', 'problem solving', 'critical thinking', 't∆∞ duy ph·∫£n bi·ªán',
                'adaptability', 'th√≠ch nghi', 's√°ng t·∫°o', 'creativity', 'time management', 'qu·∫£n l√Ω th·ªùi gian',
                'thuy·∫øt tr√¨nh', 'presentation', 'ƒë√†m ph√°n', 'negotiation', 'emotional intelligence', 'tr√≠ tu·ªá c·∫£m x√∫c'
            ];
            
            // T√¨m c√°c k·ªπ nƒÉng m·ªÅm trong CV (70% c·ªßa tr·ªçng s·ªë)
            const foundSoftSkills = softSkillKeywords.filter(skill => 
                cvText.toLowerCase().includes(skill.toLowerCase())).length;
            softSkillsScore += Math.min(softSkillsMax * 0.7, foundSoftSkills * (softSkillsMax * 0.1));
            
            // Ho·∫°t ƒë·ªông ngo·∫°i kh√≥a, t√¨nh nguy·ªán, c√¢u l·∫°c b·ªô (30% c·ªßa tr·ªçng s·ªë)
            const extracurricularRegex = /\bt√¨nh nguy·ªán\b|\bvolunteer\b|\bc√¢u l·∫°c b·ªô\b|\bclub\b|\bho·∫°t ƒë·ªông\b|\bactivit(y|ies)\b|\bextracurricular\b/gi;
            const extracurricularMatches = cvText.match(extracurricularRegex) || [];
            softSkillsScore += Math.min(softSkillsMax * 0.3, extracurricularMatches.length * (softSkillsMax * 0.1));
            
            breakdown.softSkills = Math.min(softSkillsMax, softSkillsScore);

            // T·ªîNG ƒêI·ªÇM
            score = breakdown.jobRelevance + breakdown.professionalism + breakdown.experience + 
                    breakdown.achievements + breakdown.skills + breakdown.softSkills + breakdown.education;
            
            console.log('CV Score Breakdown:', breakdown, 'Total:', score);
            
            return { 
                score: Math.round(Math.min(100, Math.max(0, score)) * 100) / 100,
                breakdown: {
                    jobRelevance: Math.round(breakdown.jobRelevance * 100) / 100,
                    professionalism: Math.round(breakdown.professionalism * 100) / 100,
                    experience: Math.round(breakdown.experience * 100) / 100,
                    achievements: Math.round(breakdown.achievements * 100) / 100,
                    skills: Math.round(breakdown.skills * 100) / 100,
                    softSkills: Math.round(breakdown.softSkills * 100) / 100,
                    education: Math.round(breakdown.education * 100) / 100
                },
                reason: `Ph√π h·ª£p v·ªã tr√≠: ${(breakdown.jobRelevance).toFixed(2)}/${weights.jobRelevance}, Chuy√™n nghi·ªáp: ${(breakdown.professionalism).toFixed(2)}/${weights.professionalism}, Kinh nghi·ªám: ${(breakdown.experience).toFixed(2)}/${weights.experience}, Th√†nh t·ª±u: ${(breakdown.achievements).toFixed(2)}/${weights.achievements}, K·ªπ nƒÉng chuy√™n m√¥n: ${(breakdown.skills).toFixed(2)}/${weights.skills}, K·ªπ nƒÉng m·ªÅm: ${(breakdown.softSkills).toFixed(2)}/${weights.softSkills}, H·ªçc v·∫•n: ${(breakdown.education).toFixed(2)}/${weights.education}`
            };
        }

        // Helper function to detect position from CV content
        function detectPosition(cvText, workExperience) {
            const text = cvText.toLowerCase();
            
            // Check work experience first
            if (workExperience && workExperience.length > 0) {
                const latestJob = workExperience[0].position.toLowerCase();
                if (latestJob.includes('frontend') || latestJob.includes('front-end')) return 'frontend';
                if (latestJob.includes('backend') || latestJob.includes('back-end')) return 'backend';
                if (latestJob.includes('fullstack') || latestJob.includes('full-stack')) return 'fullstack';
                if (latestJob.includes('mobile') || latestJob.includes('android') || latestJob.includes('ios')) return 'mobile';
                if (latestJob.includes('data') || latestJob.includes('analyst')) return 'data';
                if (latestJob.includes('design') || latestJob.includes('ui') || latestJob.includes('ux')) return 'design';
                if (latestJob.includes('marketing')) return 'marketing';
            }
            
            // Check CV text content
            if (text.includes('frontend') || text.includes('react') || text.includes('vue')) return 'frontend';
            if (text.includes('backend') || text.includes('server') || text.includes('api')) return 'backend';
            if (text.includes('fullstack') || text.includes('full stack')) return 'fullstack';
            if (text.includes('mobile') || text.includes('android') || text.includes('ios')) return 'mobile';
            if (text.includes('data science') || text.includes('machine learning')) return 'data';
            if (text.includes('designer') || text.includes('photoshop')) return 'design';
            if (text.includes('marketing') || text.includes('seo')) return 'marketing';
            
            return 'other';
        }

        // Helper function to calculate experience level
        function calculateExperience(workExperience) {
            if (!workExperience || workExperience.length === 0) return '0-1';
            
            let totalYears = 0;
            workExperience.forEach(exp => {
                if (exp.year_range) {
                    const years = exp.year_range.match(/(\d{4})/g);
                    if (years && years.length >= 2) {
                        totalYears += parseInt(years[1]) - parseInt(years[0]);
                    }
                }
            });
            
            if (totalYears >= 5) return '5+';
            if (totalYears >= 3) return '3-5';
            if (totalYears >= 1) return '1-3';
            return '0-1';
        }

        // Helper function to extract skills from CV text
        function extractSkills(cvText) {
            const skillKeywords = [
                'JavaScript', 'Python', 'Java', 'C++', 'C#', 'PHP', 'Ruby', 'Go', 'Rust',
                'React', 'Vue.js', 'Angular', 'Node.js', 'Express', 'Laravel', 'Django',
                'HTML', 'CSS', 'SCSS', 'Bootstrap', 'Tailwind',
                'MySQL', 'PostgreSQL', 'MongoDB', 'Redis', 'SQLite',
                'Git', 'Docker', 'AWS', 'Azure', 'Kubernetes', 'CI/CD',
                'Photoshop', 'Figma', 'Adobe XD', 'Sketch'
            ];
            
            const foundSkills = [];
            const text = cvText.toLowerCase();
            
            skillKeywords.forEach(skill => {
                if (text.includes(skill.toLowerCase())) {
                    foundSkills.push(skill);
                }
            });
            
            return foundSkills.slice(0, 8); // Limit to 8 skills
        }

        function displayUploadResults(results) {
            uploadResults.style.display = 'block';
            
            const successCount = results.filter(r => r.status === 'success').length;
            const errorCount = results.filter(r => r.status === 'error').length;

            resultsList.innerHTML = `
                <div style="background: #f0f9ff; padding: 1rem; border-radius: 10px; margin-bottom: 1rem;">
                    <h4>K·∫øt qu·∫£ x·ª≠ l√Ω:</h4>
                    <p>‚úÖ Th√†nh c√¥ng: ${successCount} file</p>
                    <p>‚ùå L·ªói: ${errorCount} file</p>
                </div>
                
                ${results.map(result => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: ${result.status === 'success' ? '#f0f9ff' : '#fef2f2'}; border-radius: 8px; margin-bottom: 0.5rem;">
                        <span>${result.file}</span>
                        <span style="color: ${result.status === 'success' ? '#10b981' : '#ef4444'};">
                            ${result.status === 'success' ? '‚úÖ Th√†nh c√¥ng' : '‚ùå L·ªói'}
                        </span>
                    </div>
                `).join('')}
                       `;
        }

        function displayCVs(cvs) {
            filteredCVs = cvs;
            cvGrid.innerHTML = '';

            if (cvs.length === 0) {
                cvGrid.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;">Kh√¥ng c√≥ CV n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc</div>';
                return;
            }

            cvs.forEach(cv => {
                const cvCard = document.createElement('div');
                cvCard.className = `cv-card ${cv.status}`;
                cvCard.innerHTML = `
                    <div class="cv-header">
                        <div class="cv-name">${cv.name}</div>
                        <div class="cv-score score-${cv.status}">${parseFloat(cv.score).toFixed(2)}</div>
                    </div>
                    <div class="cv-details">
                        <div class="cv-detail">
                            <span class="material-symbols-outlined">work</span>
                            <span>${getPositionName(cv.position)}</span>
                        </div>
                        <div class="cv-detail">
                            <span class="material-symbols-outlined">schedule</span>
                            <span>${cv.experience} nƒÉm kinh nghi·ªám</span>
                        </div>
                        <div class="cv-detail">
                            <span class="material-symbols-outlined">school</span>
                            <span>${cv.education}</span>
                        </div>
                        <div class="cv-detail">
                            <span class="material-symbols-outlined">skills</span>
                            <span>${cv.skills.slice(0, 3).join(', ')}</span>
                        </div>
                    </div>
                    <div class="cv-actions">
                        <button class="btn btn-primary btn-small" onclick="viewCVDetails('${cv.id}')">
                            <span class="material-symbols-outlined">visibility</span>
                            Xem chi ti·∫øt
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="downloadCV('${cv.id}')">
                            <span class="material-symbols-outlined">download</span>
                            T·∫£i xu·ªëng
                        </button>
                    </div>
                `;
                cvGrid.appendChild(cvCard);
            });

            // Update database stats in management tab
            const totalCvsElement = document.getElementById('total-cvs');
            const excellentCvsElement = document.getElementById('excellent-cvs');
            const goodCvsElement = document.getElementById('good-cvs');

            if (totalCvsElement) totalCvsElement.textContent = filteredCVs.length;
            if (excellentCvsElement) excellentCvsElement.textContent = filteredCVs.filter(cv => cv.score >= 90).length;
            if (goodCvsElement) goodCvsElement.textContent = filteredCVs.filter(cv => cv.score >= 80 && cv.score < 90).length;
        }

        function applyFilters() {
            const position = document.getElementById('filter-position').value;
            const experience = document.getElementById('filter-experience').value;
            const scoreRange = document.getElementById('filter-score').value;
            const keyword = document.getElementById('search-keyword').value.toLowerCase();

            let filtered = cvDatabase.filter(cv => {
                // Position filter
                if (position && cv.position !== position) return false;
                
                // Experience filter
                if (experience && cv.experience !== experience) return false;
                
                // Score filter
                if (scoreRange) {
                    const [min, max] = scoreRange.split('-').map(Number);
                    if (max) {
                        if (cv.score < min || cv.score > max) return false;
                    } else {
                        if (cv.score < min) return false;
                    }
                }
                
                // Keyword search
                if (keyword) {
                    const searchText = `${cv.name} ${cv.skills.join(' ')} ${cv.education} ${cv.position}`.toLowerCase();
                    if (!searchText.includes(keyword)) return false;
                }
                
                return true;
            });

            displayCVs(filtered);
        }

        function resetFilters() {
            document.getElementById('filter-position').value = '';
            document.getElementById('filter-experience').value = '';
            document.getElementById('filter-score').value = '';
            document.getElementById('search-keyword').value = '';
            displayCVs(cvDatabase);
        }

        function updateRanking() {
            const sortedCVs = [...cvDatabase].sort((a, b) => b.score - a.score);
            const rankingTbody = document.getElementById('ranking-tbody');
            
            if (!rankingTbody) return;
            
            rankingTbody.innerHTML = '';
            
            sortedCVs.slice(0, 20).forEach((cv, index) => {
                const rank = index + 1;
                const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';
                
                // Get score class
                let scoreClass = 'score-poor';
                if (cv.score >= 90) scoreClass = 'score-excellent';
                else if (cv.score >= 80) scoreClass = 'score-good';
                else if (cv.score >= 70) scoreClass = 'score-average';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="rank-cell">
                        <div class="rank-badge ${rankClass}">${rank}</div>
                    </td>
                    <td>
                        <div class="candidate-info">
                            <div class="candidate-avatar">${cv.name.charAt(0).toUpperCase()}</div>
                            <div class="candidate-details">
                                <h4>${cv.name}</h4>
                                <p>${cv.email || 'Kh√¥ng c√≥ email'}</p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="position-badge">${getPositionName(cv.position)}</span>
                    </td>
                    <td class="experience-cell">
                        ${cv.experience || 'N/A'}
                    </td>
                    <td class="score-cell">
                        <div class="score-badge ${scoreClass}">
                            ${parseFloat(cv.score).toFixed(1)}
                        </div>
                    </td>
                    <td class="actions-cell">
                        <div class="action-buttons">
                            <button class="action-btn primary" onclick="viewCVDetails('${cv.id}')" title="Xem chi ti·∫øt">
                                <span class="material-symbols-outlined">visibility</span>
                            </button>
                            <button class="action-btn secondary" onclick="downloadCV('${cv.id}')" title="T·∫£i xu·ªëng">
                                <span class="material-symbols-outlined">download</span>
                            </button>
                        </div>
                    </td>
                `;
                rankingTbody.appendChild(row);
            });
            
            // Add empty state if no data
            if (sortedCVs.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 2rem; color: #666;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                            <span class="material-symbols-outlined" style="font-size: 3rem; color: #cbd5e1;">folder_open</span>
                            <p>Ch∆∞a c√≥ CV n√†o trong h·ªá th·ªëng</p>
                            <p style="font-size: 0.9rem; color: #9ca3af;">T·∫£i l√™n CV ƒë·ªÉ xem b·∫£ng x·∫øp h·∫°ng</p>
                        </div>
                    </td>
                `;
                rankingTbody.appendChild(emptyRow);
            }
        }

        function updateStatistics() {
            const total = cvDatabase.length;
            const excellent = cvDatabase.filter(cv => cv.score >= 90).length;
            const good = cvDatabase.filter(cv => cv.score >= 80 && cv.score < 90).length;
            const average = total > 0 ? Math.round(cvDatabase.reduce((sum, cv) => sum + cv.score, 0) / total) : 0;

            // Update the correct element IDs based on the HTML structure
            const totalElement = document.getElementById('stat-total');
            const excellentElement = document.getElementById('stat-excellent');
            const goodElement = document.getElementById('stat-good');
            const averageElement = document.getElementById('stat-average');

            if (totalElement) totalElement.textContent = total;
            if (excellentElement) excellentElement.textContent = excellent;
            if (goodElement) goodElement.textContent = good;
            if (averageElement) averageElement.textContent = average;
        }

        function createCharts() {
            // Score distribution chart
            const scoreCanvas = document.getElementById('scoreChart');
            if (scoreCanvas) {
                const scoreCtx = scoreCanvas.getContext('2d');
                charts.scoreChart = new Chart(scoreCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Xu·∫•t s·∫Øc (180-200)', 'T·ªët (160-179)', 'Kh√° (140-159)', 'C·∫ßn c·∫£i thi·ªán (<140)'],
                        datasets: [{
                            data: [0, 0, 0, 0],
                            backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Position distribution chart
            const positionCanvas = document.getElementById('positionChart');
            if (positionCanvas) {
                const positionCtx = positionCanvas.getContext('2d');
                charts.positionChart = new Chart(positionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#667eea', '#764ba2', '#10b981', '#3b82f6',
                                '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        function updateCharts() {
            if (!charts.scoreChart || !charts.positionChart) return;

            // Update score chart
            const scoreData = [
                cvDatabase.filter(cv => cv.score >= 90).length,
                cvDatabase.filter(cv => cv.score >= 80 && cv.score < 90).length,
                cvDatabase.filter(cv => cv.score >= 70 && cv.score < 80).length,
                cvDatabase.filter(cv => cv.score < 70).length
            ];
            charts.scoreChart.data.datasets[0].data = scoreData;
            charts.scoreChart.update();

            // Update position chart
            const positions = {};
            cvDatabase.forEach(cv => {
                const positionName = getPositionName(cv.position);
                positions[positionName] = (positions[positionName] || 0) + 1;
            });
            charts.positionChart.data.labels = Object.keys(positions);
            charts.positionChart.data.datasets[0].data = Object.values(positions);
            charts.positionChart.update();
        }

        // Utility functions
        function getPositionName(position) {
            const positions = {
                frontend: 'Frontend Developer',
                backend: 'Backend Developer',
                fullstack: 'Fullstack Developer',
                mobile: 'Mobile Developer',
                data: 'Data Scientist',
                design: 'UI/UX Designer',
                marketing: 'Marketing',
                other: 'Kh√°c'
            };
            return positions[position] || position;
        }

        function getStatusText(status) {
            const statusTexts = {
                excellent: 'Xu·∫•t s·∫Øc',
                good: 'T·ªët',
                average: 'Kh√°',
                poor: 'C·∫ßn c·∫£i thi·ªán'
            };
            return statusTexts[status] || status;
        }

        function getScoreColor(score) {
            if (score >= 90) return '#10b981';
            if (score >= 80) return '#3b82f6';
            if (score >= 70) return '#f59e0b';
            return '#ef4444';
        }

        function viewCVDetails(cvId) {
            const cv = cvDatabase.find(c => c.id == cvId);
            if (!cv) return;

            // Show detailed score breakdown instead of simple alert
            showScoreBreakdown(cvId);
        }

        function downloadCV(cvId) {
            const cv = cvDatabase.find(c => c.id == cvId);
            if (!cv) return;

            // Simulate download
            alert(`ƒêang t·∫£i xu·ªëng CV c·ªßa ${cv.name}...`);
        }

        // Function to show detailed CV score breakdown
        function showScoreBreakdown(cvId) {
            const cv = cvDatabase.find(c => c.id == cvId);
            if (!cv || !cv.breakdown) return;

            const breakdown = cv.breakdown;
            // Get current weights for scoring display
            const weights = getScoringWeights();
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 2rem; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0; color: #1a202c;">Chi Ti·∫øt ƒêi·ªÉm CV</h3>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <strong>·ª®ng vi√™n:</strong> ${cv.name}<br>
                        <strong>T·ªïng ƒëi·ªÉm:</strong> <span style="color: ${getScoreColor(cv.score)}; font-weight: bold; font-size: 1.2rem;">${cv.score}/200</span>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 10px; margin-bottom: 1rem;">
                        <h4 style="margin-top: 0;">üìã C√¥ng Th·ª©c T√≠nh ƒêi·ªÉm</h4>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>üéØ M·ª©c ƒë·ªô Ph√π h·ª£p v·ªõi V·ªã tr√≠:</span>
                                <span style="font-weight: bold; color: ${breakdown.jobRelevance >= weights.jobRelevance*0.8 ? '#10b981' : breakdown.jobRelevance >= weights.jobRelevance*0.6 ? '#f59e0b' : '#ef4444'};">
                                    ${breakdown.jobRelevance}/${weights.jobRelevance}
                                </span>
                            </div>
                            <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                                <div style="background: ${breakdown.jobRelevance >= weights.jobRelevance*0.8 ? '#10b981' : breakdown.jobRelevance >= weights.jobRelevance*0.6 ? '#f59e0b' : '#ef4444'}; height: 100%; width: ${(breakdown.jobRelevance/weights.jobRelevance)*100}%; border-radius: 4px;"></div>
                            </div>
                            <small style="color: #666;">M·ª©c ƒë·ªô ph√π h·ª£p v·ªõi y√™u c·∫ßu c√¥ng vi·ªác</small>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>üìù Chuy√™n nghi·ªáp & R√µ r√†ng:</span>
                                <span style="font-weight: bold; color: ${breakdown.professionalism >= weights.professionalism*0.8 ? '#10b981' : breakdown.professionalism >= weights.professionalism*0.6 ? '#f59e0b' : '#ef4444'};">
                                    ${breakdown.professionalism}/${weights.professionalism}
                                </span>
                            </div>
                            <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                                <div style="background: ${breakdown.professionalism >= weights.professionalism*0.8 ? '#10b981' : breakdown.professionalism >= weights.professionalism*0.6 ? '#f59e0b' : '#ef4444'}; height: 100%; width: ${(breakdown.professionalism/weights.professionalism)*100}%; border-radius: 4px;"></div>
                            </div>
                            <small style="color: #666;">Email, SƒêT, h·ªç t√™n, c·∫•u tr√∫c CV, ƒë·ªô d√†i n·ªôi dung</small>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>üíº Kinh nghi·ªám l√†m vi·ªác:</span>
                                <span style="font-weight: bold; color: ${breakdown.experience >= weights.experience*0.8 ? '#10b981' : breakdown.experience >= weights.experience*0.6 ? '#f59e0b' : '#ef4444'};">
                                    ${breakdown.experience}/${weights.experience}
                                </span>
                            </div>
                            <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                                <div style="background: ${breakdown.experience >= weights.experience*0.8 ? '#10b981' : breakdown.experience >= weights.experience*0.6 ? '#f59e0b' : '#ef4444'}; height: 100%; width: ${(breakdown.experience/weights.experience)*100}%; border-radius: 4px;"></div>
                            </div>
                            <small style="color: #666;">S·ªë l∆∞·ª£ng v√† ch·∫•t l∆∞·ª£ng kinh nghi·ªám l√†m vi·ªác</small>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>üèÜ Th√†nh t·ª±u & K·∫øt qu·∫£:</span>
                                <span style="font-weight: bold; color: ${breakdown.achievements >= weights.achievements*0.8 ? '#10b981' : breakdown.achievements >= weights.achievements*0.6 ? '#f59e0b' : '#ef4444'};">
                                    ${breakdown.achievements}/${weights.achievements}
                                </span>
                            </div>
                            <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                                <div style="background: ${breakdown.achievements >= weights.achievements*0.8 ? '#10b981' : breakdown.achievements >= weights.achievements*0.6 ? '#f59e0b' : '#ef4444'}; height: 100%; width: ${(breakdown.achievements/weights.achievements)*100}%; border-radius: 4px;"></div>
                            </div>
                            <small style="color: #666;">Th√†nh t·ª±u c·ª• th·ªÉ v·ªõi con s·ªë v√† k·∫øt qu·∫£</small>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>üõ†Ô∏è K·ªπ nƒÉng chuy√™n m√¥n:</span>
                                <span style="font-weight: bold; color: ${breakdown.skills >= weights.skills*0.8 ? '#10b981' : breakdown.skills >= weights.skills*0.6 ? '#f59e0b' : '#ef4444'};">
                                    ${breakdown.skills}/${weights.skills}
                                </span>
                            </div>
                            <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                                <div style="background: ${breakdown.skills >= weights.skills*0.8 ? '#10b981' : breakdown.skills >= weights.skills*0.6 ? '#f59e0b' : '#ef4444'}; height: 100%; width: ${(breakdown.skills/weights.skills)*100}%; border-radius: 4px;"></div>
                            </div>
                            <small style="color: #666;">Ng√¥n ng·ªØ l·∫≠p tr√¨nh, framework, tools, design</small>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>ü§ù K·ªπ nƒÉng m·ªÅm:</span>
                                <span style="font-weight: bold; color: ${breakdown.softSkills >= weights.softSkills*0.8 ? '#10b981' : breakdown.softSkills >= weights.softSkills*0.6 ? '#f59e0b' : '#ef4444'};">
                                    ${breakdown.softSkills}/${weights.softSkills}
                                </span>
                            </div>
                            <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                                <div style="background: ${breakdown.softSkills >= weights.softSkills*0.8 ? '#10b981' : breakdown.softSkills >= weights.softSkills*0.6 ? '#f59e0b' : '#ef4444'}; height: 100%; width: ${(breakdown.softSkills/weights.softSkills)*100}%; border-radius: 4px;"></div>
                            </div>
                            <small style="color: #666;">K·ªπ nƒÉng giao ti·∫øp, l√†m vi·ªác nh√≥m, l√£nh ƒë·∫°o</small>
                        </div>
                        
                        <div style="margin-bottom: 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>üéì H·ªçc v·∫•n:</span>
                                <span style="font-weight: bold; color: ${breakdown.education >= weights.education*0.8 ? '#10b981' : breakdown.education >= weights.education*0.6 ? '#f59e0b' : '#ef4444'};">
                                    ${breakdown.education}/${weights.education}
                                </span>
                            </div>
                            <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                                <div style="background: ${breakdown.education >= weights.education*0.8 ? '#10b981' : breakdown.education >= weights.education*0.6 ? '#f59e0b' : '#ef4444'}; height: 100%; width: ${(breakdown.education/weights.education)*100}%; border-radius: 4px;"></div>
                            </div>
                            <small style="color: #666;">B·∫±ng c·∫•p, tr∆∞·ªùng h·ªçc, m·ª©c ƒë·ªô h·ªçc v·∫•n</small>
                        </div>
                    </div>
                    
                    <div style="background: #e6fffa; padding: 1rem; border-radius: 10px; border-left: 4px solid #10b981;">
                        <h4 style="margin-top: 0; color: #065f46;">üí° G·ª£i √Ω c·∫£i thi·ªán:</h4>
                        <ul style="margin: 0; padding-left: 1rem;">
                            ${breakdown.jobRelevance < weights.jobRelevance*0.7 ? '<li>ƒêi·ªÅu ch·ªânh CV ƒë·ªÉ ph√π h·ª£p h∆°n v·ªõi v·ªã tr√≠ ƒëang ·ª©ng tuy·ªÉn</li>' : ''}
                            ${breakdown.professionalism < weights.professionalism*0.7 ? '<li>B·ªï sung th√¥ng tin li√™n h·ªá ƒë·∫ßy ƒë·ªß v√† c·∫•u tr√∫c CV r√µ r√†ng h∆°n</li>' : ''}
                            ${breakdown.experience < weights.experience*0.7 ? '<li>M√¥ t·∫£ chi ti·∫øt h∆°n v·ªÅ kinh nghi·ªám l√†m vi·ªác v√† d·ª± √°n</li>' : ''}
                            ${breakdown.achievements < weights.achievements*0.7 ? '<li>Th√™m th√†nh t·ª±u c·ª• th·ªÉ v√† c√≥ th·ªÉ ƒë·ªãnh l∆∞·ª£ng ƒë∆∞·ª£c</li>' : ''}
                            ${breakdown.skills < weights.skills*0.7 ? '<li>Li·ªát k√™ ƒë·∫ßy ƒë·ªß k·ªπ nƒÉng chuy√™n m√¥n v√† c√¥ng ngh·ªá s·ª≠ d·ª•ng</li>' : ''}
                            ${breakdown.softSkills < weights.softSkills*0.7 ? '<li>B·ªï sung th√¥ng tin v·ªÅ k·ªπ nƒÉng m·ªÅm v√† ho·∫°t ƒë·ªông ngo·∫°i kh√≥a</li>' : ''}
                            ${breakdown.education < weights.education*0.7 ? '<li>B·ªï sung th√¥ng tin h·ªçc v·∫•n, ch·ª©ng ch·ªâ, kh√≥a h·ªçc</li>' : ''}
                            ${cv.score >= 80 ? '<li>CV r·∫•t t·ªët! Ti·∫øp t·ª•c duy tr√¨ ch·∫•t l∆∞·ª£ng n√†y.</li>' : ''}
                        </ul>
                    </div>
                    
                    <div style="text-align: right; margin-top: 1.5rem;">
                        <button onclick="this.closest('.modal').remove()" style="background: #667eea; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                            ƒê√≥ng
                        </button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            // Close on outside click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Show improvement notification
        function showCVReadingImprovement() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                z-index: 1000;
                max-width: 350px;
                font-size: 0.9rem;
                line-height: 1.4;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                    <span class="material-symbols-outlined" style="margin-right: 0.5rem;">upgrade</span>
                    <strong>Ti√™u ch√≠ ƒë√°nh gi√° t√πy ch·ªânh!</strong>
                </div>
                <div>
                    ‚úÖ ƒêi·ªÉm CV gi·ªù ƒë√¢y c√≥ th·ªÉ t√πy ch·ªânh theo nhu c·∫ßu<br>
                    ‚úÖ Tr·ªçng s·ªë linh ho·∫°t cho t·ª´ng ti√™u ch√≠<br>
                    ‚úÖ Chi ti·∫øt breakdown theo t·ª´ng m·ª•c<br>
                    ‚úÖ Tab "T√πy Ch·ªânh Ti√™u Ch√≠" ƒë·ªÉ ƒëi·ªÅu ch·ªânh
                </div>
                <div style="margin-top: 0.8rem; text-align: right;">
                    <button onclick="switchTab('settings')" 
                            style="background: rgba(255,255,255,0.3); border: none; color: white; padding: 0.3rem 0.8rem; border-radius: 5px; cursor: pointer; margin-right: 0.5rem;">
                        T√πy Ch·ªânh Ngay
                    </button>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.3rem 0.8rem; border-radius: 5px; cursor: pointer;">
                        ƒê√≥ng
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 12 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 12000);
        }

        // Show notification when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize charts
            createCharts();
            
            // Show improvement notification
            setTimeout(showCVReadingImprovement, 1000);
        });

        // AI Recruitment Advisor Chatbot
        class RecruitmentAdvisor {
            constructor() {
                this.isOpen = false;
                this.isTyping = false;
                this.messagesContainer = document.getElementById('chatbotMessages');
                this.inputTextarea = document.getElementById('chatbotInput');
                this.sendButton = document.getElementById('sendButton');
                this.chatbotContainer = document.getElementById('chatbotContainer');
                this.chatbotToggle = document.getElementById('chatbotToggle');
                this.chatbotClose = document.getElementById('chatbotClose');
                this.notificationBadge = document.getElementById('notificationBadge');
                
                this.expertKnowledge = this.initializeExpertKnowledge();
                this.conversationHistory = [];
                
                this.initializeEventListeners();
                this.showWelcomeNotification();
            }

            initializeExpertKnowledge() {
                return {
                    cvAnalysis: {
                        criteria: ['technical_skills', 'experience', 'education', 'projects', 'soft_skills'],
                        scoringMatrix: {
                            junior: { experience: 0.3, skills: 0.4, education: 0.2, projects: 0.1 },
                            mid: { experience: 0.4, skills: 0.3, education: 0.1, projects: 0.2 },
                            senior: { experience: 0.5, skills: 0.25, education: 0.05, projects: 0.2 }
                        }
                    },
                    interviewQuestions: {
                        technical: {
                            developer: [
                                "Gi·∫£i th√≠ch kh√°i ni·ªám OOP v√† c√°c nguy√™n t·∫Øc c∆° b·∫£n",
                                "S·ª± kh√°c bi·ªát gi·ªØa SQL v√† NoSQL database",
                                "C√°ch optimize performance c·ªßa ·ª©ng d·ª•ng web",
                                "Design patterns n√†o b·∫°n th∆∞·ªùng s·ª≠ d·ª•ng v√† t·∫°i sao?",
                                "C√°ch handle error v√† exception trong code"
                            ],
                            designer: [
                                "Quy tr√¨nh thi·∫øt k·∫ø UX/UI c·ªßa b·∫°n nh∆∞ th·∫ø n√†o?",
                                "C√°ch b·∫°n ƒë·∫£m b·∫£o accessibility trong thi·∫øt k·∫ø",
                                "Kinh nghi·ªám v·ªõi responsive design v√† mobile-first",
                                "Tools v√† software b·∫°n th∆∞·ªùng s·ª≠ d·ª•ng",
                                "C√°ch b·∫°n thu th·∫≠p v√† √°p d·ª•ng user feedback"
                            ]
                        },
                        behavioral: [
                            "K·ªÉ v·ªÅ m·ªôt l·∫ßn b·∫°n ph·∫£i l√†m vi·ªác d∆∞·ªõi √°p l·ª±c deadline",
                            "C√°ch b·∫°n handle conflict trong team",
                            "D·ª± √°n n√†o b·∫°n t·ª± h√†o nh·∫•t v√† t·∫°i sao?",
                            "M·ª•c ti√™u ngh·ªÅ nghi·ªáp 5 nƒÉm t·ªõi c·ªßa b·∫°n",
                            "C√°ch b·∫°n h·ªçc h·ªèi v√† c·∫≠p nh·∫≠t ki·∫øn th·ª©c m·ªõi"
                        ]
                    },
                    salaryBenchmarks: {
                        hanoi: {
                            developer: { junior: '8-15', mid: '15-25', senior: '25-40' },
                            designer: { junior: '7-12', mid: '12-20', senior: '20-35' },
                            pm: { junior: '10-18', mid: '18-30', senior: '30-50' }
                        },
                        hcm: {
                            developer: { junior: '10-18', mid: '18-30', senior: '30-50' },
                            designer: { junior: '8-15', mid: '15-25', senior: '25-40' },
                            pm: { junior: '12-22', mid: '22-35', senior: '35-60' }
                        }
                    },
                    recruitmentTips: [
                        "ƒê√°nh gi√° cultural fit l√† quan tr·ªçng nh∆∞ technical skills",
                        "S·ª≠ d·ª•ng structured interview ƒë·ªÉ ƒë·∫£m b·∫£o c√¥ng b·∫±ng",
                        "Provide clear job description v√† expectations",
                        "Give constructive feedback cho candidates",
                        "Build strong employer brand ƒë·ªÉ attract top talents"
                    ]
                };
            }

            initializeEventListeners() {
                this.chatbotToggle.addEventListener('click', () => this.toggleChat());
                this.chatbotClose.addEventListener('click', () => this.closeChat());
                this.sendButton.addEventListener('click', () => this.sendMessage());
                
                this.inputTextarea.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                this.inputTextarea.addEventListener('input', () => {
                    this.autoResizeTextarea();
                    this.sendButton.disabled = !this.inputTextarea.value.trim();
                });

                // Suggestion chips
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('suggestion-chip')) {
                        const suggestion = e.target.getAttribute('data-suggestion');
                        this.inputTextarea.value = suggestion;
                        this.sendMessage();
                    }
                });
            }

            showWelcomeNotification() {
                setTimeout(() => {
                    this.notificationBadge.style.display = 'flex';
                    this.chatbotToggle.style.animation = 'bounceIn 0.5s ease';
                }, 3000);
            }

            toggleChat() {
                this.isOpen = !this.isOpen;
                this.chatbotContainer.classList.toggle('open', this.isOpen);
                this.notificationBadge.style.display = 'none';
                
                if (this.isOpen) {
                    this.inputTextarea.focus();
                }
            }

            closeChat() {
                this.isOpen = false;
                this.chatbotContainer.classList.remove('open');
            }

            autoResizeTextarea() {
                this.inputTextarea.style.height = 'auto';
                this.inputTextarea.style.height = Math.min(this.inputTextarea.scrollHeight, 80) + 'px';
            }

            async sendMessage() {
                const message = this.inputTextarea.value.trim();
                if (!message || this.isTyping) return;

                this.addMessage(message, 'user');
                this.inputTextarea.value = '';
                this.autoResizeTextarea();
                this.sendButton.disabled = true;

                this.showTypingIndicator();
                
                try {
                    const response = await this.generateResponse(message);
                    this.hideTypingIndicator();
                    this.addMessage(response.text, 'bot', response.suggestions);
                } catch (error) {
                    this.hideTypingIndicator();
                    this.addMessage('Xin l·ªói, t√¥i g·∫∑p s·ª± c·ªë k·ªπ thu·∫≠t. Vui l√≤ng th·ª≠ l·∫°i sau.', 'bot');
                }
            }

            addMessage(content, sender, suggestions = []) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                
                const avatar = sender === 'bot' ? 'ü§ñ' : 'üë§';
                const time = new Date().toLocaleTimeString('vi-VN', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                let suggestionsHTML = '';
                if (suggestions.length > 0) {
                    suggestionsHTML = `
                        <div class="suggestion-chips">
                            ${suggestions.map(s => `
                                <div class="suggestion-chip" data-suggestion="${s}">${s}</div>
                            `).join('')}
                        </div>
                    `;
                }

                messageDiv.innerHTML = `
                    <div class="message-avatar">${avatar}</div>
                    <div>
                        <div class="message-content">${content}</div>
                        ${suggestionsHTML}
                        <div class="message-time">${time}</div>
                    </div>
                `;

                this.messagesContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }

            showTypingIndicator() {
                this.isTyping = true;
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.id = 'typingIndicator';
                
                typingDiv.innerHTML = `
                    <div class="message-avatar">ü§ñ</div>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                `;

                this.messagesContainer.appendChild(typingDiv);
                this.scrollToBottom();
            }

            hideTypingIndicator() {
                this.isTyping = false;
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            async generateResponse(userMessage) {
                // Simulate AI processing delay
                await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1000));
                
                const message = userMessage.toLowerCase();
                this.conversationHistory.push({ user: userMessage, timestamp: Date.now() });

                // Analyze current CV database
                if (this.containsKeywords(message, ['ph√¢n t√≠ch', 'd·ªØ li·ªáu', 'cv hi·ªán t·∫°i', 'th·ªëng k√™', 'b√°o c√°o'])) {
                    return this.handleDataAnalysisQuery(message);
                }

                // Top candidates
                if (this.containsKeywords(message, ['top', '·ª©ng vi√™n', 'xu·∫•t s·∫Øc', 't·ªët nh·∫•t', 'ranking'])) {
                    return this.handleTopCandidatesQuery(message);
                }

                // Position statistics
                if (this.containsKeywords(message, ['th·ªëng k√™', 'v·ªã tr√≠', 'position', 'ph√¢n b·ªë'])) {
                    return this.handlePositionStatsQuery(message);
                }

                // CV Analysis
                if (this.containsKeywords(message, ['cv', 'h·ªì s∆°', 'ƒë√°nh gi√°', 'ch·∫•m ƒëi·ªÉm'])) {
                    return this.handleCVAnalysisQuery(message);
                }

                // Interview Questions
                if (this.containsKeywords(message, ['ph·ªèng v·∫•n', 'c√¢u h·ªèi', 'interview'])) {
                    return this.handleInterviewQuery(message);
                }

                // Salary Inquiry
                if (this.containsKeywords(message, ['l∆∞∆°ng', 'salary', 'm·ª©c l∆∞∆°ng', 'th·ªã tr∆∞·ªùng'])) {
                    return this.handleSalaryQuery(message);
                }

                // Recruitment Strategy
                if (this.containsKeywords(message, ['chi·∫øn l∆∞·ª£c', 'tuy·ªÉn d·ª•ng', 'strategy', 'recruit'])) {
                    return this.handleStrategyQuery(message);
                }

                // General/Default Response
                return this.handleGeneralQuery(message);
            }

            containsKeywords(text, keywords) {
                return keywords.some(keyword => text.includes(keyword));
            }

            handleDataAnalysisQuery(message) {
                const total = cvDatabase.length;
                const excellent = cvDatabase.filter(cv => cv.score >= 90).length;
                const good = cvDatabase.filter(cv => cv.score >= 80 && cv.score < 90).length;
                const average = cvDatabase.filter(cv => cv.score >= 70 && cv.score < 80).length;
                const poor = cvDatabase.filter(cv => cv.score < 70).length;
                const avgScore = total > 0 ? Math.round(cvDatabase.reduce((sum, cv) => sum + cv.score, 0) / total) : 0;

                // Position distribution
                const positions = {};
                cvDatabase.forEach(cv => {
                    const pos = getPositionName(cv.position);
                    positions[pos] = (positions[pos] || 0) + 1;
                });

                const topPosition = Object.keys(positions).reduce((a, b) => positions[a] > positions[b] ? a : b, '');

                return {
                    text: `üìä **Ph√¢n t√≠ch d·ªØ li·ªáu CV hi·ªán t·∫°i:**

**üìà T·ªïng quan:**
‚Ä¢ T·ªïng s·ªë CV: ${total} h·ªì s∆°
‚Ä¢ ƒêi·ªÉm trung b√¨nh: ${avgScore}/200
‚Ä¢ V·ªã tr√≠ ph·ªï bi·∫øn nh·∫•t: ${topPosition}

**‚≠ê Ph√¢n lo·∫°i ch·∫•t l∆∞·ª£ng:**
‚Ä¢ Xu·∫•t s·∫Øc (180-200): ${excellent} CV (${total > 0 ? Math.round(excellent/total*100) : 0}%)
‚Ä¢ T·ªët (160-179): ${good} CV (${total > 0 ? Math.round(good/total*100) : 0}%)
‚Ä¢ Kh√° (140-159): ${average} CV (${total > 0 ? Math.round(average/total*100) : 0}%)
‚Ä¢ C·∫ßn c·∫£i thi·ªán (<140): ${poor} CV (${total > 0 ? Math.round(poor/total*100) : 0}%)

**üíº Ph√¢n b·ªë v·ªã tr√≠:**
${Object.entries(positions).slice(0, 5).map(([pos, count]) => 
    `‚Ä¢ ${pos}: ${count} CV`).join('\n')}

**üí° Khuy·∫øn ngh·ªã:**
${excellent > 0 ? '‚Ä¢ C√≥ ' + excellent + ' ·ª©ng vi√™n xu·∫•t s·∫Øc ƒë√°ng ch√∫ √Ω' : '‚Ä¢ C·∫ßn t√¨m ki·∫øm th√™m ·ª©ng vi√™n ch·∫•t l∆∞·ª£ng cao'}
${poor > total * 0.3 ? '‚Ä¢ C√¢n nh·∫Øc n√¢ng cao ti√™u chu·∫©n tuy·ªÉn d·ª•ng' : '‚Ä¢ Ch·∫•t l∆∞·ª£ng CV t·ªïng th·ªÉ kh√° t·ªët'}`,
                    suggestions: [
                        "Top 5 ·ª©ng vi√™n xu·∫•t s·∫Øc nh·∫•t",
                        "CV c·∫ßn c·∫£i thi·ªán",
                        "Ph√¢n t√≠ch theo k·ªπ nƒÉng"
                    ]
                };
            }

            handleTopCandidatesQuery(message) {
                const sortedCVs = [...cvDatabase].sort((a, b) => b.score - a.score);
                const topCandidates = sortedCVs.slice(0, 5);

                if (topCandidates.length === 0) {
                    return {
                        text: 'üìÇ Hi·ªán t·∫°i ch∆∞a c√≥ CV n√†o trong h·ªá th·ªëng. Vui l√≤ng t·∫£i l√™n CV ƒë·ªÉ ph√¢n t√≠ch.',
                        suggestions: ['H∆∞·ªõng d·∫´n t·∫£i CV', 'Ti√™u ch√≠ ƒë√°nh gi√° CV']
                    };
                }

                return {
                    text: `üèÜ **Top ${topCandidates.length} ·ª©ng vi√™n xu·∫•t s·∫Øc nh·∫•t:**

${topCandidates.map((cv, index) => {
    const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
    return `${medal} **${cv.name}**
   ‚Ä¢ ƒêi·ªÉm: ${cv.score}/200
   ‚Ä¢ V·ªã tr√≠: ${getPositionName(cv.position)}
   ‚Ä¢ Kinh nghi·ªám: ${cv.experience}
   ‚Ä¢ K·ªπ nƒÉng n·ªïi b·∫≠t: ${cv.skills.slice(0, 3).join(', ')}`;
}).join('\n\n')}

**üí° ƒê√°nh gi√° chung:**
‚Ä¢ ƒêi·ªÉm cao nh·∫•t: ${topCandidates[0].score}/200
‚Ä¢ K·ªπ nƒÉng ƒëa d·∫°ng: ${[...new Set(topCandidates.flatMap(cv => cv.skills))].length} k·ªπ nƒÉng kh√°c nhau
‚Ä¢ Ph√π h·ª£p cho ph·ªèng v·∫•n tr·ª±c ti·∫øp

**üéØ Khuy·∫øn ngh·ªã:**
‚Ä¢ ∆Øu ti√™n li√™n h·ªá top 3 ·ª©ng vi√™n
‚Ä¢ Chu·∫©n b·ªã c√¢u h·ªèi ph·ªèng v·∫•n chuy√™n s√¢u
‚Ä¢ Xem x√©t offer package c·∫°nh tranh`,
                    suggestions: [
                        "Chi ti·∫øt ·ª©ng vi√™n top 1",
                        "C√¢u h·ªèi ph·ªèng v·∫•n cho top candidates",
                        "So s√°nh v·ªõi th·ªã tr∆∞·ªùng"
                    ]
                };
            }

            handlePositionStatsQuery(message) {
                const positions = {};
                const skillsByPosition = {};
                const scoresByPosition = {};

                cvDatabase.forEach(cv => {
                    const pos = getPositionName(cv.position);
                    positions[pos] = (positions[pos] || 0) + 1;
                    
                    if (!skillsByPosition[pos]) skillsByPosition[pos] = [];
                    skillsByPosition[pos].push(...cv.skills);
                    
                    if (!scoresByPosition[pos]) scoresByPosition[pos] = [];
                    scoresByPosition[pos].push(cv.score);
                });

                const sortedPositions = Object.entries(positions)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);

                return {
                    text: `üìà **Th·ªëng k√™ CV theo v·ªã tr√≠:**

**üìä Ph√¢n b·ªë v·ªã tr√≠ (Top 5):**
${sortedPositions.map(([pos, count], index) => {
    const percentage = Math.round(count / cvDatabase.length * 100);
    const avgScore = scoresByPosition[pos] ? 
        Math.round(scoresByPosition[pos].reduce((a,b) => a+b, 0) / scoresByPosition[pos].length) : 0;
    const topSkills = skillsByPosition[pos] ? 
        [...new Set(skillsByPosition[pos])].slice(0, 3).join(', ') : 'N/A';
    
    return `${index + 1}. **${pos}**
   ‚Ä¢ S·ªë l∆∞·ª£ng: ${count} CV (${percentage}%)
   ‚Ä¢ ƒêi·ªÉm TB: ${avgScore}/200
   ‚Ä¢ K·ªπ nƒÉng ph·ªï bi·∫øn: ${topSkills}`;
}).join('\n\n')}

**üéØ Insight t·ª´ d·ªØ li·ªáu:**
‚Ä¢ V·ªã tr√≠ c√≥ nhu c·∫ßu cao nh·∫•t: ${sortedPositions[0] ? sortedPositions[0][0] : 'N/A'}
‚Ä¢ Ch·∫•t l∆∞·ª£ng ·ª©ng vi√™n t·ªët nh·∫•t: ${
    Object.entries(scoresByPosition)
        .map(([pos, scores]) => [pos, scores.reduce((a,b) => a+b, 0) / scores.length])
        .sort(([,a], [,b]) => b - a)[0]?.[0] || 'N/A'
}
‚Ä¢ C·∫ßn tƒÉng c∆∞·ªùng tuy·ªÉn d·ª•ng: ${sortedPositions.length < 3 ? 'C√°c v·ªã tr√≠ kh√°c' : 'Balanced distribution'}

**üí° Khuy·∫øn ngh·ªã tuy·ªÉn d·ª•ng:**
‚Ä¢ Focus v√†o ${sortedPositions[0]?.[0]} do nhu c·∫ßu cao
‚Ä¢ Develop job posting cho v·ªã tr√≠ thi·∫øu h·ª•t
‚Ä¢ Optimize recruitment strategy theo t·ª´ng v·ªã tr√≠`,
                    suggestions: [
                        "Ph√¢n t√≠ch k·ªπ nƒÉng theo v·ªã tr√≠",
                        "Benchmark l∆∞∆°ng theo v·ªã tr√≠", 
                        "Chi·∫øn l∆∞·ª£c tuy·ªÉn d·ª•ng"
                    ]
                };
            }

            handleCVAnalysisQuery(message) {
                // Get current weights to show in the response
                const weights = getScoringWeights();
                
                const responses = [
                    {
                        text: `üìä **H∆∞·ªõng d·∫´n ph√¢n t√≠ch CV chuy√™n nghi·ªáp:**

**1. ƒê√°nh gi√° k·ªπ nƒÉng k·ªπ thu·∫≠t (40%)**
‚Ä¢ Ki·ªÉm tra ƒë·ªô ph√π h·ª£p v·ªõi job requirements
‚Ä¢ ƒê√°nh gi√° m·ª©c ƒë·ªô expertise qua projects
‚Ä¢ Xem x√©t certifications v√† training

**2. Kinh nghi·ªám l√†m vi·ªác (35%)**
‚Ä¢ Th·ªùi gian l√†m vi·ªác t·∫°i m·ªói c√¥ng ty
‚Ä¢ Progression trong career path
‚Ä¢ Relevance c·ªßa previous roles

**3. Soft skills & Cultural fit (25%)**
‚Ä¢ Communication skills qua CV presentation
‚Ä¢ Leadership experience
‚Ä¢ Teamwork indicators

**üí° C√¥ng th·ª©c t√≠nh ƒëi·ªÉm Tech CV (T√πy ch·ªânh):**
‚Ä¢ Chuy√™n nghi·ªáp & R√µ r√†ng: ${weights.professionalism} ƒëi·ªÉm
‚Ä¢ Kinh nghi·ªám l√†m vi·ªác: ${weights.experience} ƒëi·ªÉm
‚Ä¢ K·ªπ nƒÉng chuy√™n m√¥n: ${weights.skills} ƒëi·ªÉm
‚Ä¢ H·ªçc v·∫•n: ${weights.education} ƒëi·ªÉm

**üéØ M·∫πo:** B·∫°n c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh tr·ªçng s·ªë ƒë√°nh gi√° CV ·ªü tab "T√πy Ch·ªânh Ti√™u Ch√≠" ƒë·ªÉ ph√π h·ª£p v·ªõi nhu c·∫ßu tuy·ªÉn d·ª•ng c·ªßa b·∫°n!`,
                        suggestions: [
                            "Template ƒë√°nh gi√° CV",
                            "Red flags c·∫ßn tr√°nh trong CV",
                            "C√°ch ch·ªânh s·ª≠a ti√™u ch√≠ ƒë√°nh gi√°"
                        ]
                    }
                ];
                
                return responses[0];
            }

            handleInterviewQuery(message) {
                let position = 'developer';
                if (message.includes('designer') || message.includes('thi·∫øt k·∫ø')) position = 'designer';
                if (message.includes('pm') || message.includes('project manager')) position = 'pm';

                const techQuestions = this.expertKnowledge.interviewQuestions.technical[position] || 
                                   this.expertKnowledge.interviewQuestions.technical.developer;
                
                const behavioralQuestions = this.expertKnowledge.interviewQuestions.behavioral;

                return {
                    text: `‚ùì **C√¢u h·ªèi ph·ªèng v·∫•n cho ${position.toUpperCase()}:**

**Technical Questions:**
${techQuestions.slice(0, 3).map((q, i) => `${i + 1}. ${q}`).join('\n')}

**Behavioral Questions:**
${behavioralQuestions.slice(0, 3).map((q, i) => `${i + 1}. ${q}`).join('\n')}

**üí° Tips ph·ªèng v·∫•n:**
‚Ä¢ S·ª≠ d·ª•ng STAR method ƒë·ªÉ evaluate answers
‚Ä¢ Prepare follow-up questions
‚Ä¢ Create comfortable interview environment
‚Ä¢ ƒê√°nh gi√° c·∫£ technical v√† cultural fit`,
                    suggestions: [
                        "C√¢u h·ªèi technical advanced",
                        "C√°ch ƒë√°nh gi√° soft skills",
                        "Tips t·∫°o kh√¥ng kh√≠ tho·∫£i m√°i"
                    ]
                };
            }

            handleSalaryQuery(message) {
                let city = 'hanoi';
                if (message.includes('hcm') || message.includes('s√†i g√≤n') || message.includes('tp.hcm')) {
                    city = 'hcm';
                }

                let position = 'developer';
                if (message.includes('designer')) position = 'designer';
                if (message.includes('pm') || message.includes('project manager')) position = 'pm';

                const cityName = city === 'hanoi' ? 'H√† N·ªôi' : 'TP.HCM';
                const salaryData = this.expertKnowledge.salaryBenchmarks[city][position];

                return {
                    text: `üí∞ **M·ª©c l∆∞∆°ng ${position.toUpperCase()} t·∫°i ${cityName}:**

**Junior Level:** ${salaryData.junior} tri·ªáu VND/th√°ng
**Mid Level:** ${salaryData.mid} tri·ªáu VND/th√°ng  
**Senior Level:** ${salaryData.senior} tri·ªáu VND/th√°ng

**Factors ·∫£nh h∆∞·ªüng l∆∞∆°ng:**
‚Ä¢ Company size & industry
‚Ä¢ Specific tech stack expertise
‚Ä¢ English proficiency
‚Ä¢ Leadership experience
‚Ä¢ Market demand

**üí° Negotiation Tips:**
‚Ä¢ Research company's salary range
‚Ä¢ Highlight unique value proposition
‚Ä¢ Consider total compensation package
‚Ä¢ Be flexible v·ªõi benefits

**üìä So s√°nh v·ªõi CV database:**
${cvDatabase.length > 0 ? 
`‚Ä¢ Avg score c·ªßa ${position}: ${Math.round(cvDatabase.filter(cv => cv.position === position).reduce((sum, cv) => sum + cv.score, 0) / Math.max(1, cvDatabase.filter(cv => cv.position === position).length))}/200
‚Ä¢ Top candidate score: ${Math.max(...cvDatabase.filter(cv => cv.position === position).map(cv => cv.score), 0)}/200` : 
'‚Ä¢ Ch∆∞a c√≥ d·ªØ li·ªáu CV ƒë·ªÉ so s√°nh'}`,
                    suggestions: [
                        "So s√°nh l∆∞∆°ng theo th√†nh ph·ªë",
                        "Benefits package chu·∫©n",
                        "C√°ch negotiate l∆∞∆°ng hi·ªáu qu·∫£"
                    ]
                };
            }

            handleStrategyQuery(message) {
                const tips = this.expertKnowledge.recruitmentTips;
                const randomTips = tips.sort(() => 0.5 - Math.random()).slice(0, 3);

                return {
                    text: `üéØ **Chi·∫øn l∆∞·ª£c tuy·ªÉn d·ª•ng hi·ªáu qu·∫£:**

**1. Pre-recruitment Planning**
‚Ä¢ Define clear job requirements & expectations
‚Ä¢ Create compelling job descriptions
‚Ä¢ Set realistic timeline & budget

**2. Sourcing Strategy**
‚Ä¢ Diversify sourcing channels (job boards, social media, referrals)
‚Ä¢ Build talent pipeline for future needs
‚Ä¢ Leverage employee referral programs

**3. Selection Process**
‚Ä¢ Structured interview process
‚Ä¢ Multiple stakeholder involvement
‚Ä¢ Skills assessment & cultural fit evaluation

**Best Practices t·ª´ database:**
${randomTips.map((tip, i) => `‚Ä¢ ${tip}`).join('\n')}

**üìà Insight t·ª´ CV database hi·ªán t·∫°i:**
${cvDatabase.length > 0 ? 
`‚Ä¢ Quality rate: ${Math.round(cvDatabase.filter(cv => cv.score >= 80).length / cvDatabase.length * 100)}% CV ƒë·∫°t chu·∫©n
‚Ä¢ C·∫ßn focus: ${cvDatabase.filter(cv => cv.score < 70).length > 0 ? 'N√¢ng cao ti√™u chu·∫©n screening' : 'Duy tr√¨ ch·∫•t l∆∞·ª£ng hi·ªán t·∫°i'}` :
'‚Ä¢ C·∫ßn x√¢y d·ª±ng CV database ƒë·ªÉ insights t·ªët h∆°n'}`,
                    suggestions: [
                        "Employer branding tips",
                        "Candidate experience optimization",
                        "Remote hiring strategies"
                    ]
                };
            }

            handleGeneralQuery(message) {
                const dbStats = cvDatabase.length > 0 ? {
                    total: cvDatabase.length,
                    excellent: cvDatabase.filter(cv => cv.score >= 90).length,
                    avgScore: Math.round(cvDatabase.reduce((sum, cv) => sum + cv.score, 0) / cvDatabase.length)
                } : null;

                return {
                    text: `ü§ñ **AI T∆∞ V·∫•n Tuy·ªÉn D·ª•ng - Tech CV**

T√¥i l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ tuy·ªÉn d·ª•ng! T√¥i c√≥ th·ªÉ h·ªó tr·ª£ b·∫°n:

‚Ä¢ **Ph√¢n t√≠ch d·ªØ li·ªáu CV** - Insights t·ª´ ${dbStats?.total || 0} CV trong h·ªá th·ªëng
‚Ä¢ **Top candidates** - Ranking v√† ƒë√°nh gi√° ·ª©ng vi√™n
‚Ä¢ **C√¢u h·ªèi ph·ªèng v·∫•n** - Technical & behavioral questions  
‚Ä¢ **Benchmark l∆∞∆°ng** - Market rates 2024
‚Ä¢ **Chi·∫øn l∆∞·ª£c tuy·ªÉn d·ª•ng** - Best practices & tips

${dbStats ? `
üìä **Database hi·ªán t·∫°i:**
‚Ä¢ ${dbStats.total} CV ‚Ä¢ ${dbStats.excellent} xu·∫•t s·∫Øc ‚Ä¢ ƒêi·ªÉm TB: ${dbStats.avgScore}/200` : 'üìÇ **Database tr·ªëng** - H√£y t·∫£i l√™n CV ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch!'}

H√£y cho t√¥i bi·∫øt b·∫°n c·∫ßn h·ªó tr·ª£ g√¨ c·ª• th·ªÉ! üòä`,
                    suggestions: [
                        "Ph√¢n t√≠ch d·ªØ li·ªáu CV hi·ªán t·∫°i",
                        "Top 5 ·ª©ng vi√™n xu·∫•t s·∫Øc",
                        "Th·ªëng k√™ theo v·ªã tr√≠",
                        "M·ª©c l∆∞∆°ng th·ªã tr∆∞·ªùng 2024"
                    ]
                };
            }

            scrollToBottom() {
                this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
            }
        }

        // Initialize the AI Recruitment Advisor
        document.addEventListener('DOMContentLoaded', () => {
            new RecruitmentAdvisor();
            initializeScoringSettings();
        });

        // Custom CV Scoring Weight Functions
        function getScoringWeights() {
            // Get custom weights from localStorage or use defaults
            const storedWeights = localStorage.getItem('cvScoringWeights');
            const defaultWeights = {
                jobRelevance: 25,
                professionalism: 15,
                experience: 20,
                achievements: 15,
                skills: 15,
                softSkills: 5,
                education: 5
            };
            
            return storedWeights ? JSON.parse(storedWeights) : defaultWeights;
        }
        
        function saveScoringWeights(weights) {
            localStorage.setItem('cvScoringWeights', JSON.stringify(weights));
            showNotification('ƒê√£ l∆∞u thi·∫øt l·∫≠p ti√™u ch√≠ ƒë√°nh gi√° CV', 'success');
        }
        
        function updateTotalWeight() {
            const jobRelevanceWeight = parseInt(document.getElementById('job-relevance-weight').value);
            const professionalismWeight = parseInt(document.getElementById('professionalism-weight').value);
            const experienceWeight = parseInt(document.getElementById('experience-weight').value);
            const achievementsWeight = parseInt(document.getElementById('achievements-weight').value);
            const skillsWeight = parseInt(document.getElementById('skills-weight').value);
            const softSkillsWeight = parseInt(document.getElementById('soft-skills-weight').value);
            const educationWeight = parseInt(document.getElementById('education-weight').value);
            
            const total = jobRelevanceWeight + professionalismWeight + experienceWeight + achievementsWeight + skillsWeight + softSkillsWeight + educationWeight;
            document.getElementById('total-weight').textContent = total;
            
            const warningElement = document.getElementById('weight-warning');
            if (total !== 100) {
                warningElement.style.display = 'flex';
                document.getElementById('save-weights').disabled = true;
            } else {
                warningElement.style.display = 'none';
                document.getElementById('save-weights').disabled = false;
            }
            
            // Update the preview chart
            updateWeightChart();
        }
        
        function initializeScoringSettings() {
            // Load current weights
            const weights = getScoringWeights();
            
            // Set the sliders to the stored values
            document.getElementById('job-relevance-weight').value = weights.jobRelevance;
            document.getElementById('job-relevance-value').textContent = weights.jobRelevance;
            document.getElementById('job-relevance-percent').textContent = weights.jobRelevance + '%';
            
            document.getElementById('professionalism-weight').value = weights.professionalism;
            document.getElementById('professionalism-value').textContent = weights.professionalism;
            document.getElementById('professionalism-percent').textContent = weights.professionalism + '%';
            
            document.getElementById('experience-weight').value = weights.experience;
            document.getElementById('experience-value').textContent = weights.experience;
            document.getElementById('experience-percent').textContent = weights.experience + '%';
            
            document.getElementById('achievements-weight').value = weights.achievements;
            document.getElementById('achievements-value').textContent = weights.achievements;
            document.getElementById('achievements-percent').textContent = weights.achievements + '%';
            
            document.getElementById('skills-weight').value = weights.skills;
            document.getElementById('skills-value').textContent = weights.skills;
            document.getElementById('skills-percent').textContent = weights.skills + '%';
            
            document.getElementById('soft-skills-weight').value = weights.softSkills;
            document.getElementById('soft-skills-value').textContent = weights.softSkills;
            document.getElementById('soft-skills-percent').textContent = weights.softSkills + '%';
            
            document.getElementById('education-weight').value = weights.education;
            document.getElementById('education-value').textContent = weights.education;
            document.getElementById('education-percent').textContent = weights.education + '%';
            
            // Set up event listeners for sliders
            document.querySelectorAll('.weight-slider').forEach(slider => {
                slider.addEventListener('input', function() {
                    // Update the displayed value
                    const valueDisplay = document.getElementById(this.id.replace('weight', 'value'));
                    valueDisplay.textContent = this.value;
                    
                    // Update the percentage display
                    const percentDisplay = document.getElementById(this.id.replace('weight', 'percent'));
                    if (percentDisplay) {
                        percentDisplay.textContent = this.value + '%';
                    }
                    
                    // Update total and validation
                    updateTotalWeight();
                });
            });
            
            // Set up event listeners for buttons
            document.getElementById('save-weights').addEventListener('click', function() {
                const newWeights = {
                    jobRelevance: parseInt(document.getElementById('job-relevance-weight').value),
                    professionalism: parseInt(document.getElementById('professionalism-weight').value),
                    experience: parseInt(document.getElementById('experience-weight').value),
                    achievements: parseInt(document.getElementById('achievements-weight').value),
                    skills: parseInt(document.getElementById('skills-weight').value),
                    softSkills: parseInt(document.getElementById('soft-skills-weight').value),
                    education: parseInt(document.getElementById('education-weight').value)
                };
                
                saveScoringWeights(newWeights);
                
                // Recalculate all CV scores with the new weights
                recalculateAllCVScores();
            });
            
            document.getElementById('reset-default-weights').addEventListener('click', function() {
                const defaultWeights = {
                    jobRelevance: 25,
                    professionalism: 15,
                    experience: 20,
                    achievements: 15,
                    skills: 15,
                    softSkills: 5,
                    education: 5
                };
                
                // Reset sliders
                document.getElementById('job-relevance-weight').value = defaultWeights.jobRelevance;
                document.getElementById('job-relevance-value').textContent = defaultWeights.jobRelevance;
                document.getElementById('job-relevance-percent').textContent = defaultWeights.jobRelevance + '%';
                
                document.getElementById('professionalism-weight').value = defaultWeights.professionalism;
                document.getElementById('professionalism-value').textContent = defaultWeights.professionalism;
                document.getElementById('professionalism-percent').textContent = defaultWeights.professionalism + '%';
                
                document.getElementById('experience-weight').value = defaultWeights.experience;
                document.getElementById('experience-value').textContent = defaultWeights.experience;
                document.getElementById('experience-percent').textContent = defaultWeights.experience + '%';
                
                document.getElementById('achievements-weight').value = defaultWeights.achievements;
                document.getElementById('achievements-value').textContent = defaultWeights.achievements;
                document.getElementById('achievements-percent').textContent = defaultWeights.achievements + '%';
                
                document.getElementById('skills-weight').value = defaultWeights.skills;
                document.getElementById('skills-value').textContent = defaultWeights.skills;
                document.getElementById('skills-percent').textContent = defaultWeights.skills + '%';
                
                document.getElementById('soft-skills-weight').value = defaultWeights.softSkills;
                document.getElementById('soft-skills-value').textContent = defaultWeights.softSkills;
                document.getElementById('soft-skills-percent').textContent = defaultWeights.softSkills + '%';
                
                document.getElementById('education-weight').value = defaultWeights.education;
                document.getElementById('education-value').textContent = defaultWeights.education;
                document.getElementById('education-percent').textContent = defaultWeights.education + '%';
                
                updateTotalWeight();
                
                showNotification('ƒê√£ kh√¥i ph·ª•c thi·∫øt l·∫≠p m·∫∑c ƒë·ªãnh', 'info');
            });
            
            // Initialize the chart
            createWeightChart();
            updateTotalWeight();
        }
        
        function createWeightChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            const weights = getScoringWeights();
            
            // Create gradient backgrounds for all seven criteria
            const gradient1 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient1.addColorStop(0, 'rgba(59, 130, 246, 0.9)'); // Blue - Job Relevance
            gradient1.addColorStop(1, 'rgba(59, 130, 246, 0.7)');
            
            const gradient2 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient2.addColorStop(0, 'rgba(96, 165, 250, 0.9)'); // Light Blue - Professionalism
            gradient2.addColorStop(1, 'rgba(96, 165, 250, 0.7)');
            
            const gradient3 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient3.addColorStop(0, 'rgba(52, 211, 153, 0.9)'); // Green - Experience
            gradient3.addColorStop(1, 'rgba(52, 211, 153, 0.7)');
            
            const gradient4 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient4.addColorStop(0, 'rgba(16, 185, 129, 0.9)'); // Emerald - Achievements
            gradient4.addColorStop(1, 'rgba(16, 185, 129, 0.7)');
            
            const gradient5 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient5.addColorStop(0, 'rgba(167, 139, 250, 0.9)'); // Purple - Skills
            gradient5.addColorStop(1, 'rgba(167, 139, 250, 0.7)');
            
            const gradient6 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient6.addColorStop(0, 'rgba(139, 92, 246, 0.9)'); // Violet - Soft Skills
            gradient6.addColorStop(1, 'rgba(139, 92, 246, 0.7)');
            
            const gradient7 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient7.addColorStop(0, 'rgba(251, 191, 36, 0.9)'); // Yellow - Education
            gradient7.addColorStop(1, 'rgba(251, 191, 36, 0.7)');
            
            window.weightChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [
                        'M·ª©c ƒë·ªô Ph√π h·ª£p v·ªõi V·ªã tr√≠',
                        'Chuy√™n Nghi·ªáp & R√µ R√†ng',
                        'Kinh Nghi·ªám L√†m Vi·ªác',
                        'Th√†nh t·ª±u & K·∫øt qu·∫£',
                        'K·ªπ NƒÉng Chuy√™n M√¥n',
                        'K·ªπ nƒÉng m·ªÅm / Ph·∫©m ch·∫•t c√° nh√¢n',
                        'H·ªçc V·∫•n'
                    ],
                    datasets: [{
                        data: [
                            weights.jobRelevance,
                            weights.professionalism,
                            weights.experience,
                            weights.achievements,
                            weights.skills,
                            weights.softSkills,
                            weights.education
                        ],
                        backgroundColor: [
                            gradient1,
                            gradient2,
                            gradient3,
                            gradient4,
                            gradient5,
                            gradient6,
                            gradient7
                        ],
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverBorderWidth: 5,
                        hoverBorderColor: [
                            '#3b82f6', // Blue - Job Relevance
                            '#60a5fa', // Light Blue - Professionalism
                            '#34d399', // Green - Experience
                            '#10b981', // Emerald - Achievements
                            '#a78bfa', // Purple - Skills
                            '#8b5cf6', // Violet - Soft Skills
                            '#fbbf24'  // Yellow - Education
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    radius: '90%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle',
                                boxWidth: 10,
                                font: {
                                    family: 'Inter',
                                    size: 13,
                                    weight: '600'
                                },
                                color: '#4a5568'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#1a202c',
                            bodyColor: '#4a5568',
                            titleFont: {
                                family: 'Inter',
                                size: 14,
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'Inter',
                                size: 13
                            },
                            padding: 15,
                            cornerRadius: 10,
                            boxPadding: 10,
                            borderColor: '#e2e8f0',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}% (${Math.round(context.raw)} ƒëi·ªÉm)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000,
                        easing: 'easeOutCubic'
                    }
                }
            });
        }
        
        function updateWeightChart() {
            if (!window.weightChart) return;
            
            const jobRelevanceWeight = parseInt(document.getElementById('job-relevance-weight').value);
            const professionalismWeight = parseInt(document.getElementById('professionalism-weight').value);
            const experienceWeight = parseInt(document.getElementById('experience-weight').value);
            const achievementsWeight = parseInt(document.getElementById('achievements-weight').value);
            const skillsWeight = parseInt(document.getElementById('skills-weight').value);
            const softSkillsWeight = parseInt(document.getElementById('soft-skills-weight').value);
            const educationWeight = parseInt(document.getElementById('education-weight').value);
            
            window.weightChart.data.datasets[0].data = [
                jobRelevanceWeight,
                professionalismWeight,
                experienceWeight,
                achievementsWeight,
                skillsWeight,
                softSkillsWeight,
                educationWeight
            ];
            
            window.weightChart.update();
        }
        
        function recalculateAllCVScores() {
            if (cvDatabase.length === 0) return;
            
            console.log("Recalculating all CV scores with updated weights...");
            
            // Recalculate score for each CV
            cvDatabase.forEach(cv => {
                if (cv.rawText && cv.parsedData) {
                    const newScoreResult = calculateCVScore(cv.rawText, cv.parsedData);
                    cv.score = newScoreResult.score;
                    cv.breakdown = newScoreResult.breakdown;
                    cv.reason = newScoreResult.reason;
                    
                    console.log(`Recalculated score for ${cv.name}: ${cv.score}/200`);
                    console.log("Breakdown:", cv.breakdown);
                    
                    // Update status based on new score
                    if (cv.score >= 90) cv.status = 'excellent';
                    else if (cv.score >= 80) cv.status = 'good';
                    else if (cv.score >= 70) cv.status = 'average';
                    else cv.status = 'poor';
                }
            });
            
            // Update display
            displayCVs(cvDatabase);
            updateRanking();
            updateStatistics();
            updateCharts();
            
            showNotification('T·∫•t c·∫£ ƒëi·ªÉm CV ƒë√£ ƒë∆∞·ª£c t√≠nh to√°n l·∫°i v·ªõi tr·ªçng s·ªë m·ªõi', 'success');
            
            showNotification('ƒê√£ c·∫≠p nh·∫≠t ƒëi·ªÉm cho t·∫•t c·∫£ CV theo ti√™u ch√≠ m·ªõi', 'success');
        }
        
        function showNotification(message, type = 'info') {
            const notificationContainer = document.createElement('div');
            notificationContainer.className = `notification ${type}`;
            notificationContainer.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                color: white;
                font-weight: 500;
                box-shadow: 0 4px 10px rgba(0,0,0,0.15);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            
            // Set background color based on type
            if (type === 'success') {
                notificationContainer.style.background = '#10b981';
            } else if (type === 'error') {
                notificationContainer.style.background = '#ef4444';
            } else if (type === 'warning') {
                notificationContainer.style.background = '#f59e0b';
            } else { // info
                notificationContainer.style.background = '#3b82f6';
            }
            
            notificationContainer.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.8rem;">
                    <span class="material-symbols-outlined">${type === 'success' ? 'check_circle' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notificationContainer);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notificationContainer.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notificationContainer.parentElement) {
                        notificationContainer.remove();
                    }
                }, 300);
            }, 3000);
        }

        // Add animation keyframes
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            </style>
        `);

    </script>
</body>
</html>  